<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ui-definition SYSTEM "uiDefinition.dtd">
<ui-definition id="impact-ui-def" type="PotentialImpact">
   <!--
      ================================================================ 
      Potential Impact UI Definition
      ================================================================
   -->
   <title>Potential Impact UI Definition</title>
   <function name="C_GetBusinessObjects_2" qualified-class-name="customfunctions.GetBusinessObjects" /> 
   <screen id="impact">
      <initialize>
             
         <!-- is this in the context of an assessment (or assessment template)? -->
         <set name="TEMP.fromAssessment" value="(not empty(assessment.businessObject)) or
                                                (not empty(assessmentTemplate.businessObject))" />
                                       
         <!-- the area/location of the assessment or template -->
         <set name="TEMP.assessmentArea" value="coalesce(assessment.location, assessmentTemplate.location)" />

         <!-- currently selected assessors of assessment/template -->
         <set name="TEMP.assessors" value="coalesce(assessment.assessors, assessmentTemplate.assessors)" />         

         <set name="TEMP.impactReadOnly" value="not (neverBeenSaved or canUser(currentUser, 'U', businessObject, location))" />
                 
         <set name="owner" value="if (neverbeensaved and empty(owner), currentUser, owner)" />
         

        <set name="TEMP.impactStatusCd" value="coalesce(impactStatusCd,'CREATE')"/>      
        
        
        <set name="TEMP.impactStatusValue" value="GetNamedListValueForOptionCd('x_impact_status',TEMP.impactStatusCd)"/>
         <!-- fail safe for impactStatusCd column if workflow does not set this when started. -->
         <if test="TEMP.impactStatusCd = 'CREATE' ">
            <set name="TEMP.stageCd" value="'CREATE'" />
            <set name="x_activado" value="'YES'" /> 
         </if>
         <if test="TEMP.impactStatusCd = 'CREATED'">
            <set name="TEMP.stageCd" value="'CREATED'" />
         </if>
         <if test="TEMP.impactStatusCd = 'SUBMITTED'">
            <set name="TEMP.stageCd" value="'APPROVED'" />
         </if>
         <if test="TEMP.impactStatusCd = 'APPROVED'">
            <set name="TEMP.stageCd" value="'APPROVED2'" />
         </if>
         <if test="TEMP.impactStatusCd = 'APPROVED2'">
            <set name="TEMP.stageCd" value="'NOT_SHOWN'" />
         </if>        
         <if test="TEMP.impactStatusCd = 'CREATED'">
            <set name="TEMP.stageCd" value="'SUBMITTED'" />
         </if>  

         <set name="riskCreadorRisk" value="if(empty(riskCreadorRisk),currentUser.userid,riskCreadorRisk)" />
         <!--Se agrega validacion para corregir nombre de creador al "Crear uno nuevo utilizando.."-->
         <set name="riskCreadorRisk" value="if(TEMP.impactStatusCd eq 'CREATE',currentUser.userid, riskCreadorRisk)" />      
         <set name="riskCreadorRiskAl" value="if(empty(riskCreadorRiskAl),currentUser.userid,riskCreadorRiskAl)" />
         <set name="TEMP.ValidState" value="''"/>

       <set name="ALERTA_USER_CREADOR" value="'{&quot;users&quot;:[&quot;'+riskCreadorRisk+'&quot;]}'" />   
       
         <set name="TEMP.READONLYALG" value="if(isUserInGroupOrRole(CURRENTUSER,'SII: ANALISTA DE NEGOCIO AVANZADO'),false,true) " />      

		<set name="Cod_rut" value="if(TEMP.impactStatusCd eq 'CREATE','',Cod_rut)" />
		<!--<set name="Cod_rut" value="'1'" />-->

       
      
        <set name="ESTADO_RIESGO" value="TEMP.impactStatusCd"/> 
        <set name="USUARIO_ACTUAL" value="currentUser.userid"/>        
        <set name="riskFhCreaDt" value="if(TEMP.impactStatusCd eq 'CREATE','',riskFhCreaDt)" />
        <set name="riskFhcDt" value="if(TEMP.impactStatusCd eq 'CREATE','',riskFhcDt)" />

         <!--########################################-->
      



          <set name="TEMP.EDIT" value="false" />
          <if test="TEMP.impactStatusCd eq 'CREATE' or TEMP.impactStatusCd eq 'CREATED' ">
                <if test ="isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: SpecificRisks Management')">
                      <set name="TEMP.EDIT" value="true" />
                </if>
          </if>
          <if test="TEMP.impactStatusCd eq 'SUBMITTED'  ">
                <if test ="isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: SpecificRisks approval')">
                      <set name="TEMP.EDIT" value="true" />
                </if>
          </if>
          <if test="TEMP.impactStatusCd eq 'APPROVED'  ">
                <if test ="isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: SpecificRisks approval 2')">
                      <set name="TEMP.EDIT" value="true" />
                </if>
          </if>



         <!--############## DETALLE ##########################-->
         <set name="TEMP.riskNom" value="riskNom" />
         <set name="TEMP.riskNom_VALID" value="riskNom" />
         <set name="TEMP.riskDescrip" value="riskDescrip" />
         <set name="TEMP.x_CdC_op" value="x_CdC_op" />
         <set name="TEMP.riskPartStr" value="riskPartStr" />
        
		<!--
         <set name="validFrom" value="if(riskVersNum eq 0 , now(), validFrom)" />
         <set name="TEMP.validFrom" value="validFrom" />

         <set name="validTo" value="if(riskVersNum eq 0 , parseDate('24-30-9998', 'MM-dd-yyyy'), validTo)" />
         <set name="TEMP.validTo" value="validTo" />
         -->
		 
		 <set name="validFrom" value="if(TEMP.impactStatusCd eq 'CREATE', now(), validFrom)" />
         <set name="TEMP.validFrom" value="validFrom" />  		 

		 <set name="validTo" value="if(TEMP.impactStatusCd eq 'CREATE', parseDate('24-30-9998', 'MM-dd-yyyy'), validTo)" />
         <set name="TEMP.validTo" value="validTo" />
		 
		 <set name="TEMP.today" value="now()" />
		 

        <if test="TEMP.impactStatusCd eq 'CREATE'">
          <set name="riskCreadorStr" value="''"/>
		  <set name="riskCreadorStrValid" value="''"/>
        </if>		 

         <set name="riskCreadorStr" value="if(empty(riskCreadorStr),currentUser.userid,riskCreadorStr)" />

       <if test="neverBeenSaved">
             
       <set name="RiskVar1Str" value="''" />
       <set name="RiskVar2Str" value="''" />
       
       <set name="warningMessageHTML2Atributos" value="getWarningMessageHTML('&lt;i&gt; Desvincule&lt;/i&gt; el &lt;b&gt;Segmento&lt;/b&gt;')" />
       <set name="warningMessageHTML2Segmentos" value="getWarningMessageHTML('&lt;i&gt; Desvincule&lt;/i&gt; la &lt;b&gt;ObligaciÃ³n tributaria&lt;/b&gt;')" />
         </if>
      <set name="riskEffectiveDateDTE" value="if(empty(RISKEFFECTIVEDATEDTE),now(),RISKEFFECTIVEDATEDTE)"/>
       
         <!--########################################-->
        <set name="custStatus" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject1'))" />
        <set name="TEMP.RiksOT" value="RiksOT"/>
        <set name="TEMP.RiksOT_link" value="RiksOT_link"/>
        <set name="TEMP.RIKSSEG_link" value="RIKSSEG_link"/>
        <set name="TEMP.RiksSeg" value="RiksSeg"/>
        <set name="TEMP.RiksCausa" value="RiksCausa"/>
        <set name="TEMP.Riksconse" value="Riksconse"/>
        <set name="TEMP.RiksCaracteristicas" value="RiksCaracteristicas"/>
        <set name="TEMP.RiksPat" value="RiksPat"/>
        <set name="TEMP.RiksAt" value="RiksAt"/>
        <set name="TEMP.Riskatributos" value="Riskatributos"/>
        <set name="TEMP.RiskFuenteExterna" value="RiskFuenteExterna"/>
        <set name="TEMP.RiskFuenteInterna" value="RiskFuenteInterna"/>
        <set name="TEMP.custStatustrat" value="custStatustrat"/>
        <set name="TEMP.RiskTratamientos" value="RiskTratamientos"/>
        <set name="TEMP.RiskTrtCausa" value="custStatustrat"/>
        <set name="TEMP.x_list_mcalc" value="x_list_mcalc"/>
        <set name="TEMP.x_ModProb_op" value="x_ModProb_op"/>
        <set name="TEMP.RiskPondAtr" value="RiskPondAtr"/>
        <set name="TEMP.x_ModCons_op" value="x_ModCons_op"/>
        <set name="TEMP.RiskSelectAtr" value="RiskSelectAtr"/>
        <set name="TEMP.riskEffectiveDateDTE" value="riskEffectiveDateDTE"/>
        <set name="TEMP.PIselectprocDesc" value="PIselectprocDesc"/>
        <set name="TEMP.PIselectprocDescCons" value="PIselectprocDescCons"/>



        <if test="empty(riskChangeBol)">
          <set name="riskChangeBol" value="false"/>
        </if>
        <set name="TEMP.riskChangeBol" value="riskChangeBol"/>

       
        <!-- variables de lectura-->
         <set name ="TEMP.Reversa_Risk" value="if(isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Governor Specificrisks'),false,true)"/>
         <set name ="TEMP.Reversa_Risk_all" value="if(isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Governor Specificrisks') or isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: SDI') ,true,false)"/>

         
         <set name="TEMP.Reversa_Risk_status" value="if (TEMP.impactStatusCd  eq 'APPROVED2',true, false) "/> 
         <set name="TEMP.Reversa_Risk_status_APPROVED" value="if (TEMP.impactStatusCd  eq 'CREATE' or TEMP.impactStatusCd  eq 'CREATED' or TEMP.impactStatusCd  eq 'SUBMITTED',false, true) "/> 

       <set name="TEMP.Readonly_Approved" value="if(TEMP.impactStatusCd eq 'APPROVED',(if(isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Administration'),false,true)),false)"/>     
       <set name="VALIDAADMIN" value="if(isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Administration'),true,false)"/>  

       
        <set name="riskFhCreaDt" value="if(empty(riskFhCreaDt),now(),riskFhCreaDt)" />
         <set name="riskFhcDt" value="if( empty(riskFhcDt),concat(substring(concat('',now()),8,2),'-',substring(concat('',now()),5,2),'-',substring(concat('',now()),0,4),' ', substring(concat('',now()),10,9)),riskFhcDt)" />


		<!-- <set name="TEMP.CANTDIM" value="length(toString(getLocationWithoutDimension(location, 'RiskCategory')))"/>-->
        
        <set name ="TEMP.risk_x_list_ejec" value="if(isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: SDI'),false,true)"/>

        <set name="TEMP.x_list_ejec_status" value="if (TEMP.impactStatusCd eq 'APPROVED2' or TEMP.impactStatusCd eq 'CREATED',false, true) "/> 

		 
		<set name="TEMP.buttonvalidTo2" value="''"/>
		
		<set name="TEMP.btnCreaVersionValida" value="if(isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Attributes Management'),true,false)"/>
			
        <set name="ImpactVersionNum" value="if(empty(ImpactVersionNum),1,ImpactVersionNum)"/>                
		<set name="ImpactCodigoOrigenStr" value="if(empty(ImpactCodigoOrigenStr),ImpactRk,ImpactCodigoOrigenStr)"/>
		<set name="ImpactCodigoPadreStr" value="if(empty(ImpactCodigoPadreStr),ImpactRk,ImpactCodigoPadreStr)"/>
		<set name="ImpactProtegidoStr" value="if(empty(ImpactProtegidoStr),'N',ImpactProtegidoStr)"/>

        <set name="TEMP.ImpactVersionNum" value="ImpactVersionNum"/>                
		<set name="TEMP.ImpactCodigoOrigenStr" value="ImpactCodigoOrigenStr"/>
		<set name="TEMP.ImpactCodigoPadreStr" value="ImpactCodigoPadreStr"/>
		<set name="TEMP.riskNom" value="riskNom"/>  
		
		<set name="ImpactOTOrigen" value="if(empty(ImpactOTOrigen),'0',ImpactOTOrigen)"/>
		<set name="ImpactSegOrigen" value="if(empty(ImpactSegOrigen),'0',ImpactSegOrigen)"/>
		
		<set name="RiskQuiPro" value="if(empty(RiskQuiPro),'N',RiskQuiPro)"/>
		<set name="RiskQuiCon" value="if(empty(RiskQuiCon),'N',RiskQuiCon)"/>
		
		<set name="x_ModProb_op" value="if(empty(x_ModProb_op),'Frecuencia Ponderada',x_ModProb_op)"/>
		<set name="x_ModCons_op" value="if(empty(x_ModCons_op),'Frecuencia Ponderada',x_ModCons_op)"/>		
		
		<set name="RiskQuiPro" value="if(TEMP.impactStatusCd eq 'CREATE' and x_ModProb_op eq 'Modelo Usuario', 'N', RiskQuiPro)"/> 
		<set name="RiskQuiCon" value="if(TEMP.impactStatusCd eq 'CREATE' and x_ModCons_op eq 'Modelo Usuario', 'N', RiskQuiCon)"/> 
		
		<set name="x_clicks" value="if(empty(x_clicks),10,x_clicks)"/>  		
		
     </initialize>
	  <!-- desacitvo botones de rechazar , aprobar y enviar a aprbar si el elemento esta bloqueado-->
      <if test="TEMP.impactReadOnly">

        <field name="TEMP.JavaScriptTEMP" type="string" visible="true" hideLabel="true" readonly="true">

        <help-text>
        <![CDATA[
        <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery.min.js"></script>
        <script type="text/javascript">
        var a 
          for (a of $("#toolBar button") ) {
            if (a.innerText.trim() == "Enviar para su aprobaciÃ³n" || a.innerText.trim() == "Aprobar" || a.innerText.trim() == "Guardar"  || a.innerText.trim() == "Guardar y Cerrar"  || a.innerText.trim() == "Rechazar" 
            || a.innerText.trim() == "Eliminar" ){
              a.style.display = 'none';
            }
          }
        </script>
        ]]></help-text>
        </field>

      </if>
		<!--cargo boton refrescar-->
            <field name="TEMP.botonRefrescar" type="string">
               <label>
                  <![CDATA[
                  <script language="JavaScript">
                    for (i = 0 ; i < document.querySelectorAll(".button").length ; i++){
                          if(document.querySelectorAll(".button")[i].innerText == "Cancelar"){
                            var itm = document.querySelectorAll(".button")[i];
                            var cln = itm.cloneNode(true);
                            document.querySelector("#toolBar").lastElementChild.getElementsByTagName("td")[0].appendChild(cln)
                            document.querySelector("#toolBar").lastElementChild.getElementsByTagName("div")[0].remove();
                            document.querySelectorAll(".button")[i].innerText="Refrescar";
							document.querySelectorAll(".button")[i].setAttribute("onclick","location.replace(URLactual.origin+'/SASEnterpriseGRC/PotentialImpact.do?method=select&handle='+model.businessObjectRef.split('|')[1]);");
                            break;
                          }
                        }
                        document.getElementById("PotentialImpact_TEMP.BOTONREFRESCAR").style.display = 'none';
						
						function guarda_historial(iElemento, iID, iMensaje){
						
							if (iMensaje == "Elemento ha sido versionado"){
							
									/*se manda solicitud post para actualizar historias*/
							
								  var URLactual = window.location;
								  var server = URLactual.origin;
								  var stpSrv = '/SASStoredProcess/do?_PROGRAM=';
								  var stp = '/EGRC/STP/insertaHistorialJson';
								  var elemento_="&elemento_=" + iElemento;
								  var rk_elemento_="&rk_elemento_=" + document.getElementById(iID).value;
								  var mensaje_="&mensaje_=" + iMensaje;
								  
								  var urlmesaje = server + stpSrv + stp +elemento_ + rk_elemento_ + mensaje_;
								// Ejecuta el WebService
								  $.ajax({
									url: urlmesaje,
									async: true, 
									success: function(respuesta) {
										console.log(respuesta)
										},
									error: function() {
									console.error("error al insertar el mensaje");
									}
								  });
							
							
							} else if (iMensaje == "Elemento ha sido desactivado") {
							
									// Trae el Codigo_ID 
								 if (document.querySelector("#"+iID+"_fldVal") != undefined  ){
                       id_ = $("#"+iID+"_fldVal")[0].childNodes[0].nodeValue.trim();
                  } else {
                       id_ = $("#"+iID+"_fldVal")[0].childNodes[0].nodeValue.trim();
                  };  					
								
               


									/*se manda solicitud post para actualizar historias*/
							
								  var URLactual = window.location;
								  var server = URLactual.origin;
								  var stpSrv = '/SASStoredProcess/do?_PROGRAM=';
								  var stp = '/EGRC/STP/insertaHistorialJson';
								  var elemento_="&elemento_=" + iElemento;
								  var rk_elemento_="&rk_elemento_=" + id_;
								  var mensaje_="&mensaje_=" + iMensaje;
								  
								  var urlmesaje = server + stpSrv + stp +elemento_ + rk_elemento_ + mensaje_;
								// Ejecuta el WebService
								  $.ajax({
									url: urlmesaje,
									async: true, 
									success: function(respuesta) {
										console.log(respuesta)
										},
									error: function() {
									console.error("error al insertar el mensaje");
									}
								  });
							
							};
						
						};							

                  </script>
                      ]]>


                  <message key="customObject3.field.custObj3rejected.displayName.txt" />

               </label>
            </field> 

		<!--cargar boton Crear versiÃ³n-->
         <if test="TEMP.impactStatusCd eq 'APPROVED2' and isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Attributes Management') and ImpactProtegidoStr eq 'P'">
            <field name="TEMP.botonCrearVersion" type="string">
               <label>
                  <![CDATA[
				  <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery.min.js"></script>
                  <script>

						// Crea Boton VersiÃ³n
						for (i = 0 ; i < document.querySelectorAll(".button").length ; i++){
							  if(document.querySelectorAll(".button")[i].innerText == "Cancelar"){
								var itm = document.querySelectorAll(".button")[i];
								var cln = itm.cloneNode(true);
								document.querySelector("#toolBar").lastElementChild.getElementsByTagName("td")[0].appendChild(cln)
								document.querySelectorAll(".button")[i].innerText="Crear VersiÃ³n";
								document.querySelectorAll(".button")[i].setAttribute("onclick","creanuevaversion()");
								break;
							  }
							}

						function creanuevaversion(){
							
							// Crea URL para la ejecuciÃ³n del WebService JSON que trae la Ãºltima VersiÃ³n
							var URLactual = window.location;
							var server = URLactual.origin;
							var stpSrv = '/SASStoredProcess/do?_PROGRAM=';
							var stp = '/EGRC/STP/lastVersionJson';


                if ($("#IMPACTCODIGOORIGENSTR").val() != undefined ){
                  var codigo ='&codigo=' + $("#IMPACTCODIGOORIGENSTR").val();
                
              }else{
                  var codigo ='&codigo=' + $("#IMPACTCODIGOORIGENSTR_fldVal")[0].outerText;

              }


							var custom = '&custom=' + 'POTENTIAL_IMPACT';
							var cmporigen = '&cmporigen=' + 'ImpactCodigoOrigenStr';
							var cmpnomversion = '&cmpnomversion=' + 'ImpactVersionNum';
							var url3 = '';
							url3 = server + stpSrv + stp + codigo + custom + cmporigen + cmpnomversion;	
							console.log(url3)
							// Ejecuta el WebService
							$.ajax({
								url: url3, async: false, 
								success: function(respuesta) {
									version_ = Number(respuesta.split("\n")[3].split(":")[1]);
									versionlog = respuesta;
								},
								error: function() {
									version_ = 1;
								}
							});		

							if (isNaN(version_)){
								console.log(versionlog);
								console.log(server+stpSrv+stp+codigo+custom+cmporigen+cmpnomversion);
								console.log("Fallo SP JSON:" + version_);
								window.alert("Fallo la conexiÃ³n con el servidor, por favor intente nuevamente.");
							} else {
							 
							// Trae el Codigo_ID 
							 if (document.querySelector("#POTENTIALIMPACTID_fldVal") != undefined ){
                 id_ = $("#POTENTIALIMPACTID_fldVal")[0].childNodes[0].nodeValue.trim();
              } else {
                 id_ = $("#POTENTIALIMPACTID_fldVal")[0].childNodes[0].nodeValue.trim();
              };

             
              
							
							// Trae el codigo de origen

               if ($("#IMPACTCODIGOORIGENSTR").val() != undefined ){
                  var idOrigen_ = $("#IMPACTCODIGOORIGENSTR").val();
                
              }else{
                  var idOrigen_ = $("#IMPACTCODIGOORIGENSTR_fldVal")[0].outerText;


              }


							
							// Envia parametro para crear a partir de:
							var url2 = '';
							var url2 = "PotentialImpact.do?method=createNew&handle=" + id_ + "&" + idOrigen_ + "&" + version_ + "&" + "1";
							console.log(url2);
							location.href = url2;
							};
							};
					
                        document.getElementById("PotentialImpact_TEMP.BOTONCREARVERSION").style.display = 'none';
						
                  </script>
                  ]]>


                  <message key="customObject3.field.custObj3rejected.displayName.txt" />

               </label>
            </field>
         </if>		

		 	<!--cargar boton desactivar-->
            <field name="TEMP.botondesactivar" type="string">
               <label>
                  <![CDATA[
                  <script language="JavaScript">
				  
						//Crea Boton Desactivar
						for (i = 0 ; i < document.querySelectorAll(".button").length ; i++){
							  if(document.querySelectorAll(".button")[i].innerText == "Cancelar"){
								var itm = document.querySelectorAll(".button")[i];
								var cln = itm.cloneNode(true);
								document.querySelector("#toolBar").lastElementChild.getElementsByTagName("td")[0].appendChild(cln)
								document.querySelectorAll(".button")[i].innerText = "Desactivar";
								document.querySelectorAll(".button")[i].name = "actionButtonDesactivartemp"
								document.querySelectorAll(".button")[i].setAttribute("onclick","acciondesactivar()");
								document.querySelectorAll(".button")[i].style.display = 'none';
								break;
							  }
							}
						
						var diaact = "";
						var mesact = "";

						function acciondesactivar(){
						
							// Crea URL para la ejecuciÃ³n del WebService JSON que trae el Periodo Tributario
							var URLactual = window.location;
							var server = URLactual.origin;
							var stpSrv = '/SASStoredProcess/do?_PROGRAM=';
							var stp = '/EGRC/STP/periodoTributarioJson';
							var urlpertrib = '';
							urlpertrib = server + stpSrv + stp;	
							
							// Ejecuta el WebService
							$.ajax({
								url: urlpertrib, async: false, 
								success: function(respuesta) {
									periodoTributario_ = Number(respuesta.split("\n")[3].split(":")[1]);
									periodoTributario_log = respuesta;
										},
								error: function() {
									periodoTributario_ = 1;
								}
							});

						
							var mensaje;
							var opcion = confirm("ConfirmaciÃ³n: Este elemento se desactivarÃ¡ a partir del periodo Tributario "+periodoTributario_+". Desea continuar?");
							if (opcion == true) {
								mensaje = "SI";
							} else {
								mensaje = "NO";
							}						
						
							if (mensaje == 'SI'){
								
								document.getElementById("VALIDTO_fldVal").innerText = document.getElementById("TEMP.TODAY_fldVal").outerText.split(/\n/)[1];
								document.getElementById("TEMP.BUTTONVALIDTO2").value = "Desactivado"
								document.getElementsByName('actionButtonDesactivartemp')[1].style.display = 'none'
								document.getElementById('X_ACTIVADO').value = "NO"
								
								guarda_historial("POTENTIAL_IMPACT", "POTENTIALIMPACTID", "Elemento ha sido desactivado");							

								for (k = 0 ; k < document.querySelectorAll(".button").length ; k++){
									  if(document.querySelectorAll(".button")[k].innerText.trim() == "Reversar aprobaciÃ³n 2"){
										document.querySelectorAll(".button")[k].style.display = 'none';
									  }
									  if(document.querySelectorAll(".button")[k].innerText.trim() == "Guardar"){
                    document.querySelectorAll(".button")[k].style.display = 'inline';
										document.querySelectorAll(".button")[k].onclick(event);
                    document.querySelectorAll(".button")[k].style.display = 'none';
									  }
								}									
							}
						}
						
                        document.getElementById("PotentialImpact_TEMP.BOTONDESACTIVAR").style.display = 'none';

                  </script>
                      ]]>
					  
                  <message key="customObject3.field.custObj3rejected.displayName.txt" />

               </label>
            </field>	

	
            <field name="TEMP.POPuPlOAD" type="string"   readonly="true"  >
       <label>
                <![CDATA[
        <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="/egrc/css/riskStyle.css">
      <link rel="stylesheet" type="text/css" href="/egrc/css/fixedColumns.bootstrap.min.css">     


        <script>

        $(document).ready(function(){     

        window.onload=cerrar; 
        function cerrar(){ 
        $("#carga").animate({"opacity":"0"},1000,function(){$("#carga").css("display","none");}); 
        } 
        });</script> 


            <div title="Cargando..." id="carga" class="loadPage">
               <div id="contenedor">
                  <div class="loader" id="loader"></div>
               </div>
            </div>
            </div>

          </div><td type="text"  style="display: none" 
        ]]>
      </label>
    </field>

      <field name="TEMP.stageCd" type="component" component-name="FlowDiagram" values="GetNamedListLabelValues('x_impact_status')" />
     
      <field name="VALIDAADMIN" type="readonly">
         <label>
                <![CDATA[
                  <script language="JavaScript">
                  
               if(document.querySelector("#PotentialImpact_VALIDAADMIN") != null){
                        document.querySelector("#PotentialImpact_VALIDAADMIN").style.display = 'none'
               }             
            /*agrego simbologia*/

            function simbologia (){
           var htmlin = document.querySelector("#POTENTIALIMPACTID_fldVal").innerHTML;
            document.querySelector("#POTENTIALIMPACTID_fldVal").innerHTML = htmlin+"<div class='panel panel-default' style='position: absolute;left: 80%;top: 1%;z-index: -1;  '>  <div class='panel-body'>    <span class='requiredIndicator'>*</span>  Campos  requeridos para guardar  </div></div>";

            }
            window.onload = simbologia;     
                  </script>
                  </script>
                      ]]>
            <message key="riskInstance.field.Valida_Admin.displayName.txt" />
         </label>
      </field>   

      <field name="ESTADO_RIESGO" type="readonly">
         <label>
                <![CDATA[
                  <script language="JavaScript">
                  
               if(document.querySelector("#PotentialImpact_ESTADO_RIESGO") != null){
                        document.querySelector("#PotentialImpact_ESTADO_RIESGO").style.display = 'none'
               }             
                
                  </script>
                      ]]>
            <message key="riskInstance.field.Estado_Riesgo.displayName.txt" />
         </label>
      </field> 
     
      <field name="USUARIO_ACTUAL" type="readonly">
         <label>
                <![CDATA[
                  <script language="JavaScript">
                  
               if(document.querySelector("#PotentialImpact_USUARIO_ACTUAL") != null){
                        document.querySelector("#PotentialImpact_USUARIO_ACTUAL").style.display = 'none'
               }             
                
                  </script>
                      ]]>
            <message key="riskInstance.field.Usuario_Actual.displayName.txt" />
         </label>
      </field>      
     
      <field name="ALERTA_USER_CREADOR" type="readonly">
         <label>
                <![CDATA[
                  <script language="JavaScript">
                  
               if(document.querySelector("#PotentialImpact_ALERTA_USER_CREADOR") != null){
                        document.querySelector("#PotentialImpact_ALERTA_USER_CREADOR").style.display = 'none'
               }             
                
                  </script>
                      ]]>      

            <message key="riskInstance.field.ALERTA_USER_CREADOR.displayName.txt" />
         </label>
      </field>      

      <field name="TEMP.impactStatusValue" type="readonly" >
         <label>
            <message key="riskInstance.field.riskStatusCd.displayName.txt" />
         </label>
      </field>
      <if test="not empty(workflow.activity.display)">
         <field name="workflow.activity.display" type="readonly" visible="false">
            <label>
               <message key="workflowActivity.displayName.txt" />
            </label>
         </field>
      </if>
      <if test="empty(workflow.activity.display) and not empty(workflow.started.activity.display) and workflow.activity.display != workflow.started.activity.display">
         <field name="workflow.started.activity.display" type="readonly" visible="false">
            <label>
               <message key="workflowStartedActivities.displayName.txt" />
            </label>
         </field>
      </if>



       <!--Llama a la dimension normas legales-->
   <field name="location" type="component" component-name="DimensionalLocation" default="projectAreaUsingFeature(currentUser.defaultLocation, 'riskInstance')" required="TRUE"  readonly="if(TEMP.impactStatusCd eq 'SUBMITTED' , false  , true)">
   </field>
      <tab-section id="impactTabSection">
         <tab id="details">
            <label>
               <message key="RiskInstanceWizard.step.risk.txt" />
            </label>

            <validation test="if (TEMP.RISKFUENTEINTERNA_VALID  eq 1,false,true)">
              <errmsg><message key="riskInstance.field.RISKFUENTEINTERNA_VALID.displayName.txt" /></errmsg>
            </validation>
                <validation test="if (TEMP.RISKFUENTEEXTERNA_VALID  eq 1,false,true)">
                  <errmsg><message key="riskInstance.field.RISKFUENTEEXTERNA_VALID.displayName.txt" /></errmsg>
            </validation>
              

            <field name="potentialImpactId" default="impactRk"  type="string" required="true" readonly="true">
               <label>
                  <message key="riskInstance.field.riskId.displayName.txt" />
               </label>
            </field>
<if test="TEMP.impactStatusCd eq 'CREATE' or   TEMP.impactStatusCd eq 'CREATED'   or TEMP.impactStatusCd eq 'SUBMITTED'  or TEMP.impactStatusCd eq 'APPROVED' or TEMP.impactStatusCd eq 'APPROVED2' ">
         <field name="TEMP.WWvalid" type="string" visible="true" hideLabel="true" readonly="true">
               <label><![CDATA[

                  <script type="text/javascript" language="javascript" src="/egrc/scripts/ValidRisk.js"></script>
              <script type="text/javascript" language="javascript" src="/egrc/scripts/risk_updater.js"></script>  
                  <script language="JavaScript">

                   /*elimino celda de la dimensiÃ³n*/
  var desc_risk = "RISKDESCRIP";
  var part_risk = "RISKPARTSTR";
  var cdc_risk = "X_CDC_OP";
  var vf_risk = "VALIDFROM";
  var vt_risk = "VALIDTO";
  var ValidOT = "RIKSOT";
  var ValidSeg = "RIKSSEG";
  var ValidCausa = "RIKSCAUSA";
  var ValidConce = "RIKSCONSE";
  var ValidCarac = "RIKSCARACTERISTICAS";
  var ValidPt = "RIKSPAT";
  var ValidAT = "RIKSAT";
  var ValidTrt = "CUSTSTATUSTRAT";
  var ValValoori = "RISKATRIBUTOS";
  var hidden_s = '';
  var inline_s = '';
  var mssg = '';
  var msserrortrt = "";
  var paso =[];
  var trt_in = []
  var elementos_ptr = [];
  var valPond = []
  var contpond = 0;
  var boton_value = document.getElementsByClassName("button");
  var ValidState = [
      ["#RIKSOT", "CUST_OBJ_4", "VALIDAESTADOOT"],
      ["#RIKSSEG", "CUST_OBJ_3", "VALIDAESTADOSEG"],
      ["#RIKSCAUSA", "CUST_OBJ_2", "VALIDAESTADOCAU"],
      ["#RIKSCONSE", "CUST_OBJ_5", "VALIDAESTADOCON"],
      ["#RIKSCARACTERISTICAS", "CUST_OBJ_6", "VALIDAESTADOCAR"],
      ["#RIKSPAT", "CUST_OBJ_7", "VALIDAESTADOPTR"],
      ["#RIKSAT", "CUST_OBJ_1", "VALIDAESTADOAT"],
      ["#CUSTSTATUSTRAT", "CUST_OBJ_8", "VALIDAESTADOTRT"]
  ]
  var _x_status_cd = document.querySelectorAll("#ESTADO_RIESGO_fldVal")[0].childNodes[0].nodeValue.trim();
  var valida_admin = document.querySelectorAll("#VALIDAADMIN_fldVal")[0].childNodes[0].nodeValue.trim();
  var _rolaprobadorn1 = 'Enterprise GRC: Causes Approval';
  var _rolaprobadorn2 = 'Enterprise GRC: Consequences Approval 2';
  var _tipoobjeto = 'POTENTIAL_IMPACT';
  var _idusuario = document.querySelectorAll("#USUARIO_ACTUAL_fldVal")[0].childNodes[0].nodeValue.trim();

  $(document).ready(function() {
      RiskUpdater(_idusuario);
  });

  elementos_ptr = [desc_risk, part_risk, cdc_risk, ValidOT, ValidCausa, ValidConce, ValidCarac, ValidPt, ValidAT, ValidTrt, ValValoori];
Array.prototype.unique=function(a){
                    return function(){return this.filter(a)}}(function(a,b,c){return c.indexOf(a,b+1)<0
                  })
                  
  function limpia_var() {

        /*si no hay segmento seleccionado dejo TEMP.RIKSOT_VALID_ORIGEN en 0  */
      if ($("#RIKSSEG_LINK").length >= 1){
          if ($("#RIKSSEG_LINK").val() == ""){
              $(document.getElementById("TEMP.RIKSSEG_VALID_ORIGEN")).val('0')
          }
      }

      for (var i = 0; i < elementos_ptr.length; i++) {
          datos_completos(inline_s = elementos_ptr[i]);
      }
      for (let i = 0; i < ValidState.length; i++) {
          $("#" + ValidState[i][2]).val(0)
      }

      if ($(document.getElementById("TEMP.PAT_VALID")) != undefined) {
          $(document.getElementById("TEMP.PAT_VALID")).val('')

      }

      if ($(document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID")) != undefined) {
          $(document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID")).val('')

      }

      if (Validanodo('TEMP.VALIDATTACHMENTS')) {
          value('TEMP.VALIDATTACHMENTS', '')
      }

  }


  function datos_incompletos(hidden_s) {
      document.getElementById("TEMP." + hidden_s + "_VALID").innerHTML = '1';
      document.getElementById("TEMP." + hidden_s + "_VALID").value = '1';
  };

  function datos_completos(inline_s) {
      document.getElementById("TEMP." + inline_s + "_VALID").innerHTML = '0';
      document.getElementById("TEMP." + inline_s + "_VALID").value = '0';
  };

  function alerta_analista() {
      document.getElementById("LISTAUSUARIOS").value = document.querySelectorAll("#ALERTA_USER_CREADOR_fldVal")[0].childNodes[0].nodeValue.trim();
      document.getElementById("FLAGEQUIPO").value = 1;
  };

  function validocampos(inline_s) {

      /*si no hay segmento seleccionado dejo TEMP.RIKSSEG_VALID_ORIGEN en 0  */
      if ($("#RIKSSEG_LINK").length >= 1){
          if ($("#RIKSSEG_LINK").val() == ""){
              $(document.getElementById("TEMP.RIKSSEG_VALID_ORIGEN")).val('0')
          }
      }

      var cantAtria =validaCantidad("#tablaFuenteExternaDin tbody","#mensajetablaWarningEx","#mensajeExterno");
      var cantAtrib =validaCantidad("#tablaFuenteInternaDin tbody","#mensajetablaWarningiN","#mensajeInterna");
        if (cantAtria == true){
                     datos_completos(hidden_s="RISKFUENTEEXTERNA");  
                     }else{
                     datos_completos(hidden_s="RISKFUENTEEXTERNA");
                     } 
            if (cantAtrib == true){
                     datos_completos(hidden_s="RISKFUENTEINTERNA");  
                     }else{
                     datos_completos(hidden_s="RISKFUENTEINTERNA");
                     }                  
     validaQuintiles();


      /*Lanzo mensaje*/
  
      for (let i = 0; i < ValidState.length; i++) {

          ValidStateRisk($(ValidState[i][0]).val(), ValidState[i][1], ValidState[i][2], 'Aprobado nivel 2')
      }


        if(document.getElementById('TEMP.IMPACTSTATUSVALUE_fldVal').innerText  == "Aprobado nivel 1"){
          return;
        }

      for (var i = 0; i < elementos_ptr.length; i++) {
          var tmp = document.getElementById(elementos_ptr[i]).value;
          if (tmp) {
              datos_completos(inline_s = elementos_ptr[i]);
          } else {
              datos_incompletos(hidden_s = elementos_ptr[i]);
          }
      }


      /*validaciones finales*/


      /*valido matriz de atributos*/
      var CountCaracteristica = 0;
      var CountConsecuencia = 0;
      var CountPatron = 0;
      var CheckCaracteristica = 0;
      var CheckConsecuencia = 0;
      var CheckPatron = 0;
      var tipoTabla = 'tblatb';
      var tablaAtributos = $("#" + tipoTabla).DataTable().columns().nodes();
      var tablaAtributos2 = $("#" + tipoTabla).DataTable().rows().nodes();
      $(document.getElementById("TEMP.RISKATRIBUTOSTPO_VALID")).val('')
      if (itemAllObj.size > 0) {
          if ($("#RISKATRIBUTOS").val() != "" && $("#RISKATRIBUTOS").val() != undefined) {

              $.each(tablaAtributos[0], function(index, data) {
                  if (data.innerText == "Caracteristicas") {
                      CountCaracteristica++;
                  };
                  if (data.innerText == "Consecuencia") {
                      CountConsecuencia++;
                  };
                  if (data.innerText == "PatrÃ³n de comportamiento") {
                      CountPatron++;
                  };
              });
              $.each(tablaAtributos2, function(index2, data2) {
                  if (data2.innerText.split("Caracteristicas").length - 1 > 0) {
                        $.each($(data2).find('input'),function(i,d){
                        if(d.checked){
                            CheckCaracteristica++;
                            return false;
                          }});          
                  };
                  if (data2.innerText.split("Consecuencia").length - 1 > 0) {
                      $.each($(data2).find('input'),function(i,d){
                      if(d.checked){
                        CheckConsecuencia++;
                            return false;

                      }});
                  };
                  if (data2.innerText.split("PatrÃ³n de comportamiento").length - 1 > 0) {

                      $.each($(data2).find('input'),function(i,d){
                      if(d.checked){
                        CheckPatron++;
                            return false;

                      }});
                  };
              });
              if (CheckCaracteristica < CountCaracteristica) {
                  if (mssg == "") {
                      mssg = "Caracteristica";
                  } else {
                      mssg += ", Caracteristica"
                  };
              }
              if (CountConsecuencia > 0 && CheckConsecuencia < 1) {
                  if (mssg == "") {
                      mssg = "Consecuencia";
                  } else {
                      mssg += ", Consecuencia"
                  };
              }
              if (CheckPatron < CountPatron) {
                  if (mssg == "") {
                      mssg = "PatrÃ³n de comportamiento";
                  } else {
                      mssg += ", PatrÃ³n de comportamiento"
                  };
              }

              if (mssg == "") {
                  $(document.getElementById("TEMP.RISKATRIBUTOSTPO_VALID")).val('')

              } else {
                  $(document.getElementById("TEMP.RISKATRIBUTOSTPO_VALID")).val(mssg)
              }
          }
      }

      /*valido que seleccion de atributos*/


      var mssgSelect = '';
      if (document.querySelector("#tblatb") != null || document.querySelector("#tblatb") != undefined) {
          tipoTabla = 'tblatb';
          tablaAtributos = $("#" + tipoTabla).DataTable().columns().nodes();
          $.each(tablaAtributos, function(index, data) {
              if (index >= 2) {
                  datainput = $(data).find('input');
                  var notcheck = 0;
                  $.each(datainput, function(i, datos) {
                      if ($(datos).prop('checked') === false) {
                          notcheck++;
                      }

                  });
                  if (datainput.length === notcheck) {
                      mssgSelect += $(datainput).attr('id').split('|')[1] + ',';


                  }

              }
          });

          /*valido si existen atributos faltantes*/
          if (mssgSelect == "") {
              if (document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID") != null || document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID") != undefined) {
                  $(document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID")).val('');
              }
          } else {
              if (document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID") != null || document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID") != undefined) {
                  $(document.getElementById("TEMP.RISKATRIBUTOSELECT_VALID")).val(mssgSelect.substring(mssgSelect, mssgSelect.length - 2));
              }
          }
      } else {
          console.log("no existe la tabla de tatributos..")
      }


      /* Valido PAT */
      if ($("#RISKTRATAMIENTOS") && $("#RISKTRATAMIENTOS") != "" && $("#RISKTRATAMIENTOS") != undefined) {
          var valorPat = $("#RISKTRATAMIENTOS").val();
          if (valorPat != "") {
              /*obtengo los tratamientos seleccionados*/
              if ($("#CUSTSTATUSTRAT") && $("#CUSTSTATUSTRAT") != "" && $("#CUSTSTATUSTRAT") != undefined) {

                  var trt_selec = valorPat.split("|");
                  trt_selec.forEach(function(response) {
                      trt_in.push(response.split("#")[0]);
                  });

                  /*valido si tiene al menos una categoria seleccionada */
                  var all_trt = [];
                  $.each(allpat_, function(index, data) {
                      console.log('busco ' + data)
                      /*busco */
                      for (let i = 0; i < $("#CUSTSTATUSTRAT").val().split(",").length; i++) {
                          if (data == $("#CUSTSTATUSTRAT").val().split(",")[i].split('|')[1]) {
                              all_trt.push($("#CUSTSTATUSTRAT").val().split(",")[i])
                          }
                      };
                  });


                  console.log(trt_in)
                  all_trt.forEach(function(data, index) {
                      console.log(data.split("|")[1])

                      if (trt_in.includes(trim(data.split("|")[1])) != true) {
                          paso.push (data.split("|")[0] + ' id ' + data.split("|")[1] );
                      }
                  });
                  if (paso.length > 1 ) {
                  msserrortrt= 'tener seleccionado al menos una categorÃ­a:'+paso.unique().toString();
                  console.log(msserrortrt)
                      if ($(document.getElementById('TEMP.PAT_VALID')) && $(document.getElementById('TEMP.PAT_VALID')) != "" && $(document.getElementById('TEMP.PAT_VALID')) != undefined) {
                          $(document.getElementById('TEMP.PAT_VALID')).val(msserrortrt)
                      }
                  } else {
                      $(document.getElementById('TEMP.PAT_VALID')).val('');

                  }

              }
          } else {
              /*valido si se creo la tabla */
              if($("#tablePat").length == 0){
                  $(document.getElementById('TEMP.PAT_VALID')).val('');
              }else{
                  $(document.getElementById('TEMP.PAT_VALID')).val(' seleccionar por cada tratamiento al menos una categorÃ­a');              
              }
          }
      }

      /* Valido ponderaciÃ³n */


      if ($("#RISKPONDATR") && $("#RISKPONDATR") != "" && $("#RISKPONDATR") != undefined) {
          allPonderacion = $("#RISKPONDATR").val().split("|")

          allPonderacion.forEach(function(data) {

              valPond.push(data.split(",")[1]);
              if (data.split(",")[1] == "0") {
                  contpond++;
              }

          });
          if (valPond.length == contpond) {

              if ($(document.getElementById("TEMP.RISKPONDERA_VALID")) && $(document.getElementById("TEMP.RISKPONDERA_VALID")) != undefined && $(document.getElementById("TEMP.RISKPONDERA_VALID")) != "") {
                  $(document.getElementById("TEMP.RISKPONDERA_VALID")).val(contpond)
              }


          } else {
              $(document.getElementById("TEMP.RISKPONDERA_VALID")).val('');
          }
      }

      let cantidadinput = document.querySelector("#X_MODPROB_OP").childElementCount;

      for (let i = 0; i < cantidadinput; i++) {
          let child = document.querySelector("#X_MODPROB_OP_" + i + "");
          let proc = document.querySelector("#PISELECTPROCDESC");
          let proccons = document.querySelector("#PISELECTPROCDESCCONS");
          let childcons = document.querySelector("#X_MODCONS_OP_" + i + "");
          if (child.value == "Modelo Usuario" && child.checked && proc.value == "Nada seleccionado...") {
              document.getElementsByClassName("button")[boton].style.display = "none"
          }

          if (childcons.value == "Modelo Usuario" && childcons.checked && proccons.value == "Nada seleccionado...") {
              document.getElementsByClassName("button")[boton].style.display = "none"
          }

      }

  }


  for (var j = 0; j < document.getElementsByClassName("button").length; j++) {

      if (boton_value[j].innerText && boton_value[j].innerText == "Enviar para su aprobaciÃ³n") {
          var onclick1 = String(boton_value[j].onclick);
          //remplazo funciones de boton enviar
          var onclick2 = onclick1.replace("function onclick(event) {", "");
          var onClick3 = onclick2.replace("}", "");
          var onlcik4 = "validocampos();SearchFieldRisk('POTENTIAL_IMPACT','PISELECTPROCDESC'); SearchFieldRisk('POTENTIAL_IMPACT','PISELECTPROCDESCCONS');" +
              "armavariable(document.querySelector('#RISKFUENTEINTERNA'),'#tablaFuenteInternaDin tbody','RISKFUENTEINTERNA',true);" +
              "armavariable(document.querySelector('#RISKFUENTEEXTERNA'),'#tablaFuenteExternaDin tbody','RISKFUENTEEXTERNA',true);" +
              "EnviaNotificacion(_rolaprobadorn1,model.businessObjectRef.split('|')[1],_tipoobjeto,'RISKCREADORRISK_fldVal');" +
              onClick3;
          boton_value[j].setAttribute("onclick", onlcik4);
      } else if (boton_value[j].innerText == "Guardar") {
          //remplazo funciones de boton enviar
          var onclick1 = String(boton_value[j].onclick);
          var onclick2 = onclick1.replace("function onclick(event) {", "");
          var onClick3 = onclick2.replace("}", "");
          var onlcik4 = " validaQuintiles();armavariable(document.querySelector('#RISKFUENTEINTERNA'),'#tablaFuenteInternaDin tbody','RISKFUENTEINTERNA',false);" +
              "armavariable(document.querySelector('#RISKFUENTEEXTERNA'),'#tablaFuenteExternaDin tbody','RISKFUENTEEXTERNA',false);" +
              "limpia_var();" + onClick3;
          boton_value[j].setAttribute("onclick", onlcik4);
      } else if (boton_value[j].innerText && boton_value[j].innerText == "Aprobar") {
          var onclick1 = String(boton_value[j].onclick);
          //remplazo funciones de boton Aprobar
          var onclick2 = onclick1.replace("function onclick(event) {", "");
          var onClick3 = onclick2.replace("}", "");
          if (_x_status_cd == "APPROVED") {
              var onlcik4 = "validocampos();EnviaNotificacion(_rolaprobadorn1,model.businessObjectRef.split('|')[1],_tipoobjeto,'RISKCREADORRISK_fldVal','Aprobado nivel 2');" + onClick3;

          } else {
              var onlcik4 = "validocampos();SearchFieldRisk('POTENTIAL_IMPACT','PISELECTPROCDESC'); SearchFieldRisk('POTENTIAL_IMPACT','PISELECTPROCDESCCONS');" +
                  "armavariable(document.querySelector('#RISKFUENTEINTERNA'),'#tablaFuenteInternaDin tbody','RISKFUENTEINTERNA',true);" +
                  "armavariable(document.querySelector('#RISKFUENTEEXTERNA'),'#tablaFuenteExternaDin tbody','RISKFUENTEEXTERNA',true);EnviaNotificacion(_rolaprobadorn2,model.businessObjectRef.split('|')[1],_tipoobjeto,'RISKCREADORRISK_fldVal');" +
                  onClick3;
          }
          boton_value[j].setAttribute("onclick", onlcik4);
      } else if (boton_value[j].innerText == "Guardar y Cerrar") {
          //remplazo funciones de boton enviar
          var onclick1 = String(boton_value[j].onclick);
          var onclick2 = onclick1.replace("function onclick(event) {", "");
          var onClick3 = onclick2.replace("}", "");
          var onlcik4 = "limpia_var();armavariable(document.querySelector('#RISKFUENTEINTERNA'),'#tablaFuenteInternaDin tbody','RISKFUENTEEXTERNA',false);" +
              "armavariable(document.querySelector('#RISKFUENTEEXTERNA'),'#tablaFuenteExternaDin tbody','RISKFUENTEEXTERNA',false);" + onClick3;
          boton_value[j].setAttribute("onclick", onlcik4);
      } else if (boton_value[j].innerText == "Reversar aprobaciÃ³n 2") {

          document.getElementsByClassName("button")[2].setAttribute("onclick", "limpia_var();EnviaNotificacion(_rolaprobadorn1,model.businessObjectRef.split('|')[1],_tipoobjeto,'RISKCREADORRISK_fldVal','Aprobado nivel 2');" + $(document.getElementsByClassName("button")[2]).attr('onClick'))

      } else if (boton_value[j].innerText == "Rechazar") {


                  if(_x_status_cd == "APPROVED"){
                      $($(".button")[j]).attr('onClick', "limpia_var();EnviaNotificacion(_rolaprobadorn1,model.businessObjectRef.split('|')[1],_tipoobjeto,'RISKCREADORRISK_fldVal','Aprobado nivel 2');" + $(".button")[j].onclick.toString().replace("function onclick(event) {", "").replace("}", "").trim())
                  }else{
                      $($(".button")[j]).attr('onClick', "limpia_var();EnviaNotificacion(_rolaprobadorn1,model.businessObjectRef.split('|')[1],_tipoobjeto,'RISKCREADORRISK_fldVal','Rechazo');" + $(".button")[j].onclick.toString().replace("function onclick(event) {", "").replace("}", "").trim())
                  }




      }
  }

                     </script>]]>
               </label>
         </field>
      </if>

          <!--Motivo del  rereversa-->
            <field name="riskreversed" type="string" readonly="isScreenReadOnly()">
               <label>
                  <message key="reversed.displayName.txt" />

               </label>
            </field> 

                  <!--Motivo del  rechazo-->
            <field name="riskrejected" type="string" readonly="isScreenReadOnly()">
               <label>
                  <message key="rejected.displayName.txt" />                 
               </label>
            </field>

            <field name="RISK_UPDATER" type="string" readonly="isScreenReadOnly()">
               <label>
                  <![CDATA[
                  <script language="JavaScript">
                    if(document.querySelector("#PotentialImpact_RISKREVERSED") != null){
                        document.querySelector("#PotentialImpact_RISKREVERSED").style.display = 'none'
                     }
                     if(document.querySelector("#PotentialImpact_RISKREJECTED") != null){
                        document.querySelector("#PotentialImpact_RISKREJECTED").style.display = 'none'
                     }
                     if(document.querySelector("#PotentialImpact_RISK_UPDATER") != null){
                        document.querySelector("#PotentialImpact_RISK_UPDATER").style.display = 'none'
                     }
                
                  </script>
                      ]]>
                  <message key="riskInstance.field.Risk_Updater.displayName.txt" />

               </label>
            </field>       

         <!--Envio correo: Field oculto para la lista de usuarios para el envio de correo-->
            <field name="ListaUsuarios" type="string" readonly="isScreenReadOnly()">
               <label>
                  <![CDATA[
                  <script language="JavaScript">
              
                     if(document.querySelector("#PotentialImpact_LISTAUSUARIOS") != null){
                        document.querySelector("#PotentialImpact_LISTAUSUARIOS").style.display = 'none'
                     }
                
                  </script>
                      ]]>
                  <message key="riskInstance.field.ListaUsuarios.displayName.txt" />

               </label>
            </field>
         
            <field name="FlagEquipo" type="string" readonly="isScreenReadOnly()">
               <label>
                  <![CDATA[
                  <script language="JavaScript">

                 if(document.querySelector("#PotentialImpact_FLAGEQUIPO") != null){
                        document.querySelector("#PotentialImpact_FLAGEQUIPO").style.display = 'none'
                     }

                  </script>
                      ]]>
                  <message key="riskInstance.field.FlagEquipo.displayName.txt" />

               </label>
            </field>          
           <field name="TEMP.vali" type="string"   readonly="if (TEMP.Reversa_Risk_status  eq true , true, false)">
                 <label>

                     
                    <![CDATA[

            
                     <link rel="stylesheet" type="text/css" href="/egrc/css/bootstrap.min.css">

                      <link rel="stylesheet" type="text/css" href="/egrc/css/fixedColumns.bootstrap.min.css">
                     <link rel="stylesheet" type="text/css" href="../matrix/css/jquery-ui.icon-font.min.css">
                     <link rel="stylesheet" type="text/css" href="../egrc/css/Componentes.css">

                      <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery-1.12.4.js">
                      </script>
                      
                      <script type="text/javascript" language="javascript" src="/egrc/scripts/Modal.js">
                      </script>

                     <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery.min.js"></script>
                <script type="text/javascript" language="javascript" src="/egrc/scripts/notification.component.js"></script>  
                               


                        <div id="modal" class="loadPage" style="display: none" >
                        </div> 
                        <div id="modalReverse" class="loadPage" style="display: none" >
                        </div> 
                        <div id="modalDelete" class="loadPage" style="display: none" >
                        </div> 

                     <script type="text/javascript" language="javascript" >
                      /*elimino botones */

                        var html_estado  ="TEMP.IMPACTSTATUSVALUE_fldVal";

                      if ($(document.getElementById(html_estado))[0].childNodes[0].nodeValue.trim() == "Aprobado nivel 1" || $(document.getElementById(html_estado))[0].childNodes[0].nodeValue.trim() == "Aprobado nivel 2" ){
                            $.each($("#toolBar button"),function(i,d){
                                  if($(d).text().trim() == "Guardar"){
                                    $(d).css("display","none")
                                  }else if ($(d).text().trim() == "Guardar y Cerrar"){
                                    $(d).css("display","none")

                                  }
                            })
                      } 
                        buildModal("modal","RISKREJECTED");
                        buildModalReverse("modalReverse","RISKREVERSED");

                        if (document.querySelector("#POTENTIALPOTENTIALIMPACTID_fldVal") != undefined){
                           var id_  =  $("#POTENTIALPOTENTIALIMPACTID_fldVal")[0].outerText;
                           var tipo = 'Riesgo';
                           var tipodos = 'risk';
                           /* BuildModalDelete("modalDelete",id_,tipo,tipodos);*/
                        }
                       
                     </script>
                      <td type="text"  style="display: none"
                      ]]>

                  </label>
           </field>
		   
            <!--Veces que se guarda el formulario-->
            <field name="x_clicks" type="number" required="false" readonly="false">
               <label>
			   			   
                  <![CDATA[
                  <script language="JavaScript">
					document.getElementById("PotentialImpact_X_CLICKS").style.display = 'none'
                  </script>
                      ]]>			   
			   
                  <message key="Clicks" />  
				  
               </label>
            </field>		   
		     <!--Nombre del tipo de tratamiento Temporal Para comparaciÃ³n de Caracteres ExtraÃ±os-->
            <field name="CREATENEWFROM" type="string" required="false" readonly="false">
               <label>
                 
        <!--Filtro caracteres no validos -->
                  <![CDATA[
                  <script language="JavaScript">
          document.getElementById("PotentialImpact_CREATENEWFROM").style.display = 'none'
                  </script>
                      ]]>        
         
                  <message key="customObject8.field.CREATENEWFROM.displayName.txt" />  
          
               </label>
            </field>  
            <!--Nombre del Riesgo Especifico Temporal Para comparaciÃ³n de Caracteres ExtraÃ±os-->
            <field name="TEMP.riskNom" type="string" required="false" readonly="false">
               <label>
			   			   
				<!--Filtro caracteres no validos -->
                  <![CDATA[
                  <script language="JavaScript">
					document.getElementById("PotentialImpact_TEMP.RISKNOM").style.display = 'none'
                  </script>
                      ]]>			   
			   
                  <message key="riskInstance.field.riskNom.displayName.txt" />  
				  
               </label>
            </field>			   

			<!--Nombre del Riesgo Especifico -->   
            <field name="riskNom" type="string" required="true" readonly="(if (TEMP.Reversa_Risk_status  eq true , true, false)) or TEMP.Readonly_Approved" >
               <label>
                  <message key="riskInstance.field.riskNom.displayName.txt" />
               </label>
              
            </field>

            <!--Version del Riesgo Especifico -->
            <field name="ImpactVersionNum" type="number" required="false" visible="true" readonly="false">
               <label>
                  <message key="potentialImpact.field.ImpactVersionNum.displayName.txt" />
               </label>
            </field>  

            <field name="Temp.ImpactVersionNum" type="number" required="false" visible="true" readonly="false">
               <label>
                  <message key="potentialImpact.field.ImpactVersionNum.displayName.txt" />
               </label>
            </field>			
      
            <!--Marca Protegido del Riesgo Especifico -->
            <field name="ImpactProtegidoStr" type="string" required="false" default="'N'" visible="true" readonly="true">
               <label>
                  <message key="potentialImpact.field.ImpactProtegidoStr2.displayName.txt" />
               </label>
            </field>
            
            <!--ID de origen del Riesgo Especifico -->
            <field name="ImpactCodigoOrigenStr" type="string" required="false" visible="true" readonly="false">
               <label>
                  <message key="potentialImpact.field.ImpactCodigoOrigenStr.displayName.txt" />
               </label>
            </field>
			
            <field name="Temp.ImpactCodigoOrigenStr" type="string" required="false" visible="true" readonly="false">
               <label>
                  <message key="potentialImpact.field.ImpactCodigoOrigenStr.displayName.txt" />
               </label>
            </field>			
      
            <!--ID del Padre del Riesgo Especifico -->
            <field name="ImpactCodigoPadreStr" type="string" required="false" visible="true" readonly="false">
               <label>
                  <message key="potentialImpact.field.ImpactCodigoPadreStr.displayName.txt" />
               </label>
            </field> 

            <field name="Temp.ImpactCodigoPadreStr" type="string" required="false" visible="true" readonly="false">
               <label>
                  <message key="potentialImpact.field.ImpactCodigoPadreStr.displayName.txt" />
               </label>
            </field> 

            <!--valido si existe descripcion  antes de enviar? -->
            <field name="TEMP.RISKDESCRIP_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKDESCRIP_VALID").style.display = 'none';
                            $(document.getElementById("TEMP.VALI")).css("display","none")
                      </script>]]>
					  
				   <![CDATA[
					  <script language="JavaScript">
					  
					if(window.location.search.split("createNew&handle").length >= 2){
						$.each($("button"), function(index, data) {
							if ($(data).text().trim() == "Guardar y Cerrar") {
								data.style.display = 'none';
							}
						})
					};					  
					  
					if(window.location.search.split("app").length >= 2 && document.getElementById("X_CLICKS").value==1){
						guarda_historial('POTENTIAL_IMPACT', 'IMPACTCODIGOPADRESTR', 'Elemento ha sido versionado')
					}					  
					  
					  //**** Validadores Versionamiento ****//
							
							// Deja no editables los campos de texto
							if (document.querySelector("#IMPACTVERSIONNUM") != null){ 
								document.querySelector("#IMPACTVERSIONNUM").disabled = true;};
							if (document.querySelector("#IMPACTCODIGOPADRESTR") != null){
								document.querySelector("#IMPACTCODIGOPADRESTR").disabled = true;};
							if (document.querySelector("#IMPACTCODIGOORIGENSTR") != null){
								document.querySelector("#IMPACTCODIGOORIGENSTR").disabled = true;};
							
							// Esconde los campos TEMP
							document.getElementById("PotentialImpact_TEMP.IMPACTVERSIONNUM").style.display = 'none'
							document.getElementById("PotentialImpact_TEMP.IMPACTCODIGOPADRESTR").style.display = 'none'
							document.getElementById("PotentialImpact_TEMP.IMPACTCODIGOORIGENSTR").style.display = 'none'
					  
							// Captura variables desde la URL
							var flagNuevaVersion = window.location.search.split("=")[1];
							
							// Actualiza Variables de la versiÃ³n anterior
							if (flagNuevaVersion == "createNew&handle" 
									&& window.location.search.split("=")[2].search(/&/) != -1){
								var codigoPadre = window.location.search.split("=")[2].split("&")[0];
								var codigoOrigen = window.location.search.split("=")[2].split("&")[1];
								var codigoVersion = window.location.search.split("=")[2].split("&")[2];
								var estadoParametro = window.location.search.split("=")[2].split("&")[3];
							
								document.getElementById("IMPACTVERSIONNUM").value = Number(codigoVersion) + 1;
								document.getElementById("IMPACTCODIGOPADRESTR").value = codigoPadre;
								document.getElementById("IMPACTCODIGOORIGENSTR").value = codigoOrigen;
								document.getElementById("TEMP.IMPACTVERSIONNUM").value = Number(codigoVersion) + 1;
								document.getElementById("TEMP.IMPACTCODIGOPADRESTR").value = codigoPadre;
								document.getElementById("TEMP.IMPACTCODIGOORIGENSTR").value = codigoOrigen;
								
								document.getElementById("X_CLICKS").value = 0;								
							} 
							// Crea Variables del caso Apartir de antiguo
							else if (flagNuevaVersion == "createNew&handle" 
									&& window.location.search.split("=")[2].search(/&/) == -1){
								document.getElementById("IMPACTVERSIONNUM").value = 1;
								document.getElementById("IMPACTCODIGOPADRESTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
								document.getElementById("IMPACTCODIGOORIGENSTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
								document.getElementById("TEMP.IMPACTVERSIONNUM").value = 1;
								document.getElementById("TEMP.IMPACTCODIGOPADRESTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
								document.getElementById("TEMP.IMPACTCODIGOORIGENSTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
							}							
							// Crea Variables desde 0
							else if (flagNuevaVersion=="create"){
								document.getElementById("IMPACTVERSIONNUM").value = 1;
								document.getElementById("IMPACTCODIGOPADRESTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
								document.getElementById("IMPACTCODIGOORIGENSTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
								document.getElementById("TEMP.IMPACTVERSIONNUM").value = 1;
								document.getElementById("TEMP.IMPACTCODIGOPADRESTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;
								document.getElementById("TEMP.IMPACTCODIGOORIGENSTR").value = document.querySelector("#POTENTIALIMPACTID_fldVal").outerText;							
							}
							// Carga las variables ya guardadas
							else {
								if (document.getElementById("TEMP.IMPACTVERSIONNUM") != null){
								document.getElementById("TEMP.IMPACTVERSIONNUM").value = document.getElementById("IMPACTVERSIONNUM").value;
								document.getElementById("TEMP.IMPACTCODIGOPADRESTR").value = document.getElementById("IMPACTCODIGOPADRESTR").value;
								document.getElementById("TEMP.IMPACTCODIGOORIGENSTR").value = document.getElementById("IMPACTCODIGOORIGENSTR").value;
								} else {
								document.getElementById("TEMP.IMPACTVERSIONNUM_fldVal").outerText = document.getElementById("IMPACTVERSIONNUM_fldVal").outerText;
								document.getElementById("TEMP.IMPACTCODIGOPADRESTR_fldVal").outerText = document.getElementById("IMPACTCODIGOPADRESTR_fldVal").outerText;
								document.getElementById("TEMP.IMPACTCODIGOORIGENSTR_fldVal").outerText = document.getElementById("IMPACTCODIGOORIGENSTR_fldVal").outerText;								
								}
							}

							// Obtiene el ID
							if (document.querySelector("#POTENTIALIMPACTID_fldVal").outerText.search(/\n/) == -1){
									var id_ =  $("#POTENTIALIMPACTID_fldVal")[0].childNodes[0].nodeValue.trim(); 	//Trae Codigo Actual
							} else {
									var id_ =  $("#POTENTIALIMPACTID_fldVal")[0].childNodes[0].nodeValue.trim(); 	//Trae Codigo Actual
							};							
							
							// Deshabilita Field Nombre
							if (document.querySelector("#RISKNOM") != null){
								if (document.getElementById("IMPACTCODIGOORIGENSTR").value != id_) {
										document.querySelector("#RISKNOM").disabled = true;
								}								
							};
							
							if (document.getElementById('IMPACTVERSIONNUM') != null){
								document.getElementById('IMPACTVERSIONNUM').size=10;
								document.getElementById('IMPACTCODIGOORIGENSTR').size=10;
								document.getElementById('IMPACTCODIGOPADRESTR').size=10;
							};

							/* Validacion Caracteres ExtraÃ±os */
							if (document.querySelector("#RISKNOM") != null){
								var Nombre_Anterior = document.getElementById('RISKNOM').value;
								setInterval(function() {
										if (document.getElementById('RISKNOM').value != document.getElementById('TEMP.RISKNOM').value) {
											document.getElementById('RISKNOM').value = document.getElementById('RISKNOM').value.replace(/[/.\*+?^${}()\Â´\Â´|\[\]\&Â¬Â°'",;\\]/gi, '');
											document.getElementById('TEMP.RISKNOM').value = document.getElementById('RISKNOM').value;
										};
								}, 100);
								setTimeout('document.getElementById("RISKNOM").value = Nombre_Anterior', 3000);
							};							

							//****************************************//
                      if(window.location.search.split("createNewFrom").length >= 2){
            $.each($("button"), function(index, data) {
              if ($(data).text().trim() == "Guardar y Cerrar") {
                if($("#CREATENEWFROM").length > 0 ){
                    $("#CREATENEWFROM").val('si')
                }
              }
            })
          };

            /*es copiado a partir de uno*/
            if($("#CREATENEWFROM").val() == "si"){
              if (document.getElementById('TEMP.IMPACTSTATUSVALUE_fldVal').innerText=="En creaciÃ³n" || document.getElementById('TEMP.IMPACTSTATUSVALUE_fldVal').innerText=="Creado"){
                    eliminaVinculo();
                  };  
            }



          /********************************************/
					  </script>
					]]>						  
					  
               <message key="valido si existe descripcion  antes de enviar " />
               </label>
              <on-change>
              <set-required name="riskDescrip" test="TEMP.RISKDESCRIP_VALID gt 0"/>
              </on-change>
            </field>

            <field name="riskDescrip" type="textarea" required="false" readonly="(if (TEMP.Reversa_Risk_status eq true , true, false)) or TEMP.Readonly_Approved">
               <label>
                  <message key="riskInstance.field.riskDescrip.displayName.txt" />
               </label>
            </field>


            <field name="TEMP.RISKPARTSTR_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKPARTSTR_VALID").style.display = 'none';

                      </script>]]>
               <message key="valido si existe participante  antes de enviar " />
               </label>
              <on-change>
              <set-required name="riskPartStr" test="TEMP.RISKPARTSTR_VALID gt 0"/>
              </on-change>
            </field>

              <field name="riskPartStr" type="textarea" required="false" readonly="(if (TEMP.Reversa_Risk_status  eq true , true, false)) or TEMP.Readonly_Approved">
               <label>
                  <message key="riskInstance.field.riskPartStr.displayName.txt" />
               </label>
            </field>

            <!--Comportamiento del cotribuyente-->

            <field name="TEMP.X_CDC_OP_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.X_CDC_OP_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existe Comportamiento del cotribuyente  antes de enviar " />
               </label>
              <on-change>
              <set-required name="x_CdC_op" test="TEMP.X_CDC_OP_VALID gt 0"/>
              </on-change>
            </field>

            <field name="x_CdC_op" type="dropdown" required="false" values="getNamedListLabelValues('list_CdC')" readonly="(if (TEMP.Reversa_Risk_status  eq true , true, false)) or TEMP.Readonly_Approved">
               <label>
                  <message key="riskInstance.field.x_CdC_op.displayName.txt" />
               </label>
            </field>

            <!--valido si existe Vigencia del riesgo  desde  antes de enviar? -->
            <field name="TEMP.VALIDFROM_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.VALIDFROM_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existe Vigencia del riesgo  desde  antes de enviar " />
               </label>
              <on-change>
              <set-required name="validFrom" test="TEMP.VALIDFROM_VALID gt 0"/>
              </on-change>
            </field> 

            <!--Vigencia del Riesgo especifico desde -->
            <field name="validFrom" type="date" readonly="true" required="false">
               <label>
                  <message key="control.field.activeFromDttm.displayName.txt" />
               </label>
            </field>
            <!--Vigencia del Riesgo especifico hasta -->


            <!--valido si existe Vigencia del riesgo  antes de enviar? -->
            <field name="TEMP.VALIDTO_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.VALIDTO_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existe Vigencia del riesgo  antes de enviar" />
                  </label>
              <on-change>
              <set-required name="validTo" test="TEMP.VALIDTO_VALID gt 0"/>
              </on-change>
            </field>

			<!--Vigencia del Riesgo Especifico hasta -->
            <field name="validTo" type="date" readonly="true" required="false" min="validFrom" >
               <label>
                  <message key="control.field.activeToDttm.displayName.txt" />
               </label>
            </field>
			
            <!--Flag Activado -->
            <field name="x_activado" type="string" required="false" readonly="false">
               <label>
						<![CDATA[<script language="JavaScript">
							document.getElementById("PotentialImpact_X_ACTIVADO").style.display = 'none';
						</script>]]>			   
                  <message key="Flag Activado" />
               </label>
            </field>			
			
            <!--fecha Actual -->
            <field name="TEMP.today" type="date"  required="false" readonly="true">
               <label>
					<![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.TODAY").style.display = 'none';
						 
						// Escondemos el boton de Reversar cuando ya esta desactivado o Protegido
						if (document.getElementById('VALIDTO_fldVal').outerText != '30-12-9999' && 
							document.getElementById('VALIDTO_fldVal').outerText != '30/12/9999') { 
								for (k = 0 ; k < document.querySelectorAll(".button").length ; k++){
									  if(document.querySelectorAll(".button")[k].innerText == "Reversar aprobaciÃ³n 2"){
										document.querySelectorAll(".button")[k].style.display = 'none';
										break;
									  }
									}
						}
						
						if (document.getElementById('IMPACTPROTEGIDOSTR_fldVal').outerText == 'P') {
							for (k = 0 ; k < document.querySelectorAll(".button").length ; k++){
								  if(document.querySelectorAll(".button")[k].innerText == "Reversar aprobaciÃ³n 2"){
									document.querySelectorAll(".button")[k].style.display = 'none';
									break;
								  }
								}						
						}
						
					</script>]]>			   
                  <message key="Fecha Actual"  />
               </label>
            </field>			
			
			<if test="TEMP.impactStatusCd eq 'APPROVED2' and isUserInGroupOrRole(CURRENTUSER,'Enterprise GRC: Governor Specificrisks') and validTo eq parseDate('24-30-9998', 'MM-dd-yyyy')">
				<!--Boton desactivaciÃ³n -->
				<field name="TEMP.buttonvalidTo" type="string" required="false"  readonly="false"> 
				   <label>
					  <message key="control.field.activeToDttm.displayName.txt" />
				   </label>
				</field>			
				
				<!--Boton desactivaciÃ³n ProgramaciÃ³n JavaScript -->
				<field name="TEMP.buttonvalidTo2" type="string" required="false"  readonly="false"> 
				   <label>
				   
							<![CDATA[<script language="JavaScript">
								
								// Copiamos la funcionalidad del boton de la Toolbox que creamos anteriormente 
								// para generar un nuevo boton donde esta el Field
								document.getElementById('TEMP.BUTTONVALIDTO_fldVal').outerHTML = document.getElementsByName('actionButtonDesactivartemp')[0].outerHTML
								document.getElementById('TEMP.BUTTONVALIDTO_fldLbl').innerText=''
								document.getElementById("PotentialImpact_TEMP.BUTTONVALIDTO2").style.display = 'none';
								document.getElementsByName('actionButtonDesactivartemp')[1].style.display = '';
								
								var flagNuevaVersion3 = window.location.search.split("=")[1];
								if (flagNuevaVersion3 == "createNewFrom&handle"){						
									document.getElementById('X_ACTIVADO').value = "YES";
								}								
								

                if (document.getElementById('X_ACTIVADO') != null){
                  if(document.getElementById('X_ACTIVADO').value == "NO"){
                    document.getElementsByName('actionButtonDesactivartemp')[1].style.display = 'none'
                  }
                }else if (document.getElementById('X_ACTIVADO_fldVal') != null ){
                    if(document.getElementById('X_ACTIVADO_fldVal')[0].childNodes[0].nodeValue== "NO"){
                    document.getElementsByName('actionButtonDesactivartemp')[1].style.display = 'none'
                  }
                }
                

							</script>]]>
							   
					  <message key="control.field.activeToDttm.displayName.txt" />
				   </label>
				</field>	
			</if>			

            <!--ID del Origen de la Obligacion Tributaria -->
            <field name="ImpactOTOrigen" type="string" required="false" visible="true" readonly="false">
               <label>
						<![CDATA[<script language="JavaScript">
						document.getElementById("PotentialImpact_IMPACTOTORIGEN").style.display = 'none';
						</script>]]>			   
                  <message key="Origen OT" />
               </label>
            </field>

            <!--ID del Padre del Segmento -->
            <field name="ImpactSegOrigen" type="string" required="false" visible="true" readonly="false">
               <label>
						<![CDATA[<script language="JavaScript">
						document.getElementById("PotentialImpact_IMPACTSEGORIGEN").style.display = 'none';
						</script>]]>	
                  <message key="Origen Segmento" />
               </label>
            </field>
        
            <!--valido si existen obligaciones asociados antes de enviar-->
            <field name="TEMP.RIKSOT_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RIKSOT_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existen obligaciones asociados antes de enviar" />
                  </label>
            </field>
            <!--valido si existen obligaciones asociados antes de enviar-->
            <field name="TEMP.RIKSOT_VALID_ORIGEN" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RIKSOT_VALID_ORIGEN").style.display = 'none';
                      </script>]]>
               <message key="valido ORGIEN DE LA OBLIGACION" />
                  </label>
            </field>

            <field name="RiksOT" type="string" visible="true">
               <label>
                  <message key="todas las obligaciones" />

                      <![CDATA[<script language="JavaScript">
                         if (document.querySelector("#PotentialImpact_RIKSOT") != null){
                          document.querySelector("#PotentialImpact_RIKSOT").style.display = 'none';
                         }
                      </script>]]>
            </label>

            </field>


            <field name="RiksOT_link" type="string" visible="true">
               <label>
                  <message key="OBLIGACION A VALIDAR" />


                      <![CDATA[<script language="JavaScript">
                         if (document.querySelector("#PotentialImpact_RIKSOT_LINK") != null){
                          document.querySelector("#PotentialImpact_RIKSOT_LINK").style.display = 'none';
                         }
                      </script>]]>

            </label>

            </field>



                                  <!--Link hacia obligacion tributaria-->  
            <section id="RiksObligacion" expanded="true">
               <label>
                  <message key="riskInstance.Obligacion.section.Link.txt" />
               </label>
				
				<validation test="if (RiskVar1Str = 'E',false,true)">
					<errmsg ><message key="riskInstance.field.displayName.Oblig.Error.txt" /></errmsg> 
				</validation>
				
				<validation test="if (TEMP.RIKSOT_VALID gt 0,false,true)">
					<errmsg ><message key="riskInstance.field.RiksObligacion.displayName.txt"/></errmsg> 
				</validation>
				
				<validation test="if (TEMP.RIKSOT_VALID_ORIGEN gt 0,false,true)">
					<errmsg ><message key="riskInstance.field.displayName.ObligLink.Error.txt" /></errmsg>
				</validation>
				
				<validation test="TEMP.ValidaEstadoOt_ EQ 'E' " >
					<errmsg><message key="errors.invalid.links.txt"><param value="ValidaEstadoOt" /></message></errmsg>
				</validation>  
					
       <if test="TEMP.impactReadOnly eq 'APPROVED2'">
        <field  name ="OT" type="component" component-name="LinkedBusinessObjects" required="false"  readonly="true" >  

                  <param name="linkTypeSourceSystemCd" value="'MON'" />
                  <param name="linkTypeId" value="'x_potential_x_customObject4'" />
                  
          <!-- Filtra Elemendos Desactivados-->
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
          <param name="a:filterExpression">x_activado=YES</param>
                
              <on-change>
                   <set-value name="RiksOT" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject4'))+''" /> 
                   <set-value name="RiksOT_link" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject4'))+''" />                              
              </on-change> 

        </field>
       </if>
        <if test="TEMP.impactReadOnly ne 'APPROVED2'">
        <field  name ="OT" type="component" component-name="LinkedBusinessObjects" required="false"  readonly=" isScreenReadOnly() or TEMP.Readonly_Approved" >  

                  <param name="linkTypeSourceSystemCd" value="'MON'" />
                  <param name="linkTypeId" value="'x_potential_x_customObject4'" />
                  
          <!-- Filtra Elemendos Desactivados-->
          
                <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
          <param name="a:filterExpression">x_activado=YES</param>
              <on-change>
                   <set-value name="RiksOT" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject4'))+''" /> 
                   <set-value name="RiksOT_link" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject4'))+''" />                              
              </on-change> 

        </field>
      </if>       



            </section>
			
			<!-- validaciÃ³n de estados de las obligaciones tributarias-->
			<field name="ValidaEstadoOt" type="string"  default="'0'">
					  <label>
						 <message key="riskInstance.ValidaEstadoOt.title.txt" />
					  </label>       
			</field> 
			
            <!--valido si existen segementos asociados antes de enviar -->
            <field name="TEMP.RIKSSEG_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RIKSSEG_VALID").style.display = 'none';
                        if($("#PotentialImpact_VALIDAESTADOOT")!="" && $("#PotentialImpact_VALIDAESTADOOT") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOOT").css("display","none")
                        }
                      </script>]]>
               <message key="valido si existen segementos asociados antes de enviar" />
                  </label>
            </field>
			
            <!--valido si existen obligaciones asociados antes de enviar-->
            <field name="TEMP.RIKSSEG_VALID_ORIGEN" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RIKSSEG_VALID_ORIGEN").style.display = 'none';
                      </script>]]>
               <message key="valido ORGIEN DEL SEGMENTO" />
                  </label>
            </field>		


            <field name="RiksSeg" type="string" visible="true">
               <label>
                  <message key="todos los segmentos" />
                </label>

            </field>
            <field name="RIKSSEG_link" type="string" visible="true">
               <label>
                  <message key="todos los segmentos link " />
                         <![CDATA[<script language="JavaScript">
                      </script>]]>


                </label>

            </field>            

            <!--Link hacia segmentos-->
			<section id="Segmentos" expanded="true">

				<label>
					<message key="riskInstance.Segmentos.section.Link.txt" />                
				</label>
				
				<validation test="if (RiskVar2Str = 'E',false,true)">
					<errmsg ><message key="riskInstance.field.displayName.Error.txt" /></errmsg> 
				</validation>
				
				<validation test="TEMP.ValidaEstadoSeg_ EQ 'E' " >
					<errmsg><message key="errors.ValidaEstadoSeg_.links.txt"><param value="ValidaEstadoSeg" /></message></errmsg>
				</validation>

				<validation test="if (TEMP.RIKSSEG_VALID gt 0,false,true)">
					<errmsg ><message key="riskInstance.field.Segmentos.displayName.txt" /></errmsg> 
				</validation>
				
				<validation test="if (TEMP.RIKSSEG_VALID_ORIGEN gt 0,false,true)">
					   <errmsg ><message key="riskInstance.field.displayName.SegLink.Error.txt" /></errmsg>
				</validation>				


       <if test="TEMP.impactReadOnly eq 'APPROVED2'">
        <field  name ="segment" type="component" component-name="LinkedBusinessObjects" required="false" readonly="true">             
          <param name="linkTypeSourceSystemCd" value="'MON'" />
          <param name="linkTypeId" value="'x_potential_x_customObject3'" />
          
          <!-- Filtra Elemendos Desactivados-->
          
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
          <param name="a:filterExpression">x_activado=YES</param>
          <on-change>
            <set-value name="RiksSeg" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject3'))" />                               
            <set-value name="RIKSSEG_link" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject3'))" />                               
          </on-change> 
        </field>

       </if>
       <if test="TEMP.impactReadOnly ne 'APPROVED2'">
        <field  name ="segment" type="component" component-name="LinkedBusinessObjects" required="false" readonly="isScreenReadOnly() or TEMP.Readonly_Approved ">             
          <param name="linkTypeSourceSystemCd" value="'MON'" />
          <param name="linkTypeId" value="'x_potential_x_customObject3'" />
          
          <!-- Filtra Elemendos Desactivados-->
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
          <param name="a:filterExpression">x_activado=YES</param>
          <on-change>
            <set-value name="RiksSeg" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject3'))" />                               
            <set-value name="RIKSSEG_link" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject3'))" />                               
          </on-change> 
        </field>
        
       </if>
				
			</section>
            
			<!-- validaciÃ³n de estados de los segmentos-->
			<field name="ValidaEstadoSeg" type="string"  default="'0'">
					  <label>
						 <message key="riskInstance.ValidaEstadoSeg.title.txt" />
					  </label>       

			</field>

            <!--  valido si existen una causa  asociados antes de enviar --> 
            <field name="TEMP.RIKSCAUSA_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">

                      if($("#PotentialImpact_VALIDAESTADOSEG")!="" && $("#PotentialImpact_VALIDAESTADOSEG") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOSEG").css("display","none")
                        }

                         document.getElementById("PotentialImpact_TEMP.RIKSCAUSA_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existen una causa  asociados antes de enviar" />
                  </label>

            </field>

            <field name="RiksCausa" type="string" visible="true">
               <label>
                  <message key="todas las causas" />
                                    <![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_RIKSSEG").style.display = 'none';
                         document.getElementById("PotentialImpact_RIKSSEG_LINK").style.display = 'none';
                         
                      </script>]]>  
                    </label>
            </field>


            <!--Link hacia causas-->
            <section id="Causas" visible="true" required="false">
               <label>
                  <message key="riskInstance.Causas.section.Link.txt" />                  
               </label>
               <validation test="if (TEMP.RIKSCAUSA_VALID gt 0,false,true)">
                  <errmsg ><message key="riskInstance.field.Causas.displayName.txt" /></errmsg> 
               </validation>
              <validation test="TEMP.ValidaEstadoCau_ EQ 'E' " >
              <errmsg><message key="errors.ValidaEstadoCau_.links.txt"><param value="ValidaEstadoCau" /></message></errmsg>
              </validation>

             <if test="TEMP.impactReadOnly eq 'APPROVED2'">
                   <field  name ="causes" type="component" component-name="LinkedBusinessObjects" readonly="true">
                      <param name="linkTypeSourceSystemCd" value="'MON'" />
                      <param name="linkTypeId" value="'x_potential_x_customObject2'" />
                      
              <!-- Filtra Elemendos Desactivados-->
              
                    
                  <on-change>
                       <set-value name="RiksCausa" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject2'))" />                               
                  </on-change> 
                   </field> 
             </if>
              <if test="TEMP.impactReadOnly ne  'APPROVED2'">
                  <field  name ="causes" type="component" component-name="LinkedBusinessObjects" readonly="isScreenReadOnly() or TEMP.Readonly_Approved ">
                      <param name="linkTypeSourceSystemCd" value="'MON'" />
                      <param name="linkTypeId" value="'x_potential_x_customObject2'" />
                      
              <!-- Filtra Elemendos Desactivados-->
              
                              <!-- Filtra Elemendos Desactivados-->
                    <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                    <param name="a:filterExpression">x_activado=YES</param>
                  <on-change>
                       <set-value name="RiksCausa" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject2'))" />                               
                  </on-change> 
                   </field> 
              </if>

            </section>

                    <!-- validaciÃ³n de estados de las causas-->
              <field name="ValidaEstadoCau" type="string"  default="'0'">
                          <label>
                             <message key="riskInstance.ValidaEstadoCau.title.txt" />
                          </label>       

              </field>

            <!--  valido si existen una consecuencia  asociadas antes de enviar --> 
            <field name="TEMP.RIKSCONSE_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">

                      if($("#PotentialImpact_VALIDAESTADOCAU")!="" && $("#PotentialImpact_VALIDAESTADOCAU") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOCAU").css("display","none")
                        }

                         document.getElementById("PotentialImpact_TEMP.RIKSCONSE_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existen una consecuencia  asociadas antes de enviar" />
                  </label>

            </field>


            <field name="Riksconse" type="string" visible="true">
               <label>
                  <message key="todas las consecuencias" />
                  <![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_RIKSCAUSA").style.display = 'none';
                      </script>]]>                    
                    </label>
            </field>

            <!--Link hacia consecuencia-->
            <section id="Riksconsecuencia" visible="true" required="false">
               <label>
                  <message key="riskInstance.Consecuencias.section.Link.txt" />
               </label>
                <validation test="if (TEMP.RIKSCONSE_VALID gt 0,false,true)">
                  <errmsg ><message key="riskInstance.field.Riksconse.displayName.txt " /></errmsg> 
               </validation>
              <validation test="TEMP.ValidaEstadoCon_ EQ 'E' " >
              <errmsg><message key="errors.ValidaEstadoCon_.links.txt"><param value="ValidaEstadoCon" /></message></errmsg>
              </validation> 
                <if test="TEMP.impactReadOnly eq 'APPROVED2'">
                  <field name ="cons" type="component" component-name="LinkedBusinessObjects" readonly=" true  ">
                  <param name="linkTypeSourceSystemCd" value="'MON'" />
                  <param name="linkTypeId" value="'x_potential_x_customObject5'" />
                  
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
          <param name="a:filterExpression">x_activado=YES</param>
                
              <on-change>
                   <set-value name="Riksconse" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject5'))" />                               
              </on-change>                   
               </field>
                </if>
                <if test="TEMP.impactReadOnly ne 'APPROVED2'">
                  <field name ="cons" type="component" component-name="LinkedBusinessObjects" readonly="isScreenReadOnly() or TEMP.Readonly_Approved  ">
                  <param name="linkTypeSourceSystemCd" value="'MON'" />
                  <param name="linkTypeId" value="'x_potential_x_customObject5'" />
                  
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
          <param name="a:filterExpression">x_activado=YES</param>
                
              <on-change>
                   <set-value name="Riksconse" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject5'))" />                               
              </on-change>                   
               </field>
                </if>

            </section>
         
                    <!-- validaciÃ³n de estados de las  consecuencias-->
              <field name="ValidaEstadoCon" type="string"  default="'0'">
                          <label>
                             <message key="riskInstance.ValidaEstadoCon.title.txt" />
                          </label>       

              </field>


            <!--  valido si existen una Caracteristica  asociadas antes de enviar --> 
            <field name="TEMP.RIKSCARACTERISTICAS_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                        if($("#PotentialImpact_VALIDAESTADOCON")!="" && $("#PotentialImpact_VALIDAESTADOCON") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOCON").css("display","none")
                        }

                         document.getElementById("PotentialImpact_TEMP.RIKSCARACTERISTICAS_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existen una Caracteristica  asociadas antes de enviar" />
                  </label>

            </field>

            <field name="RiksCaracteristicas" type="string" visible="true">
               <label>
                  <message key="todas las caracteristicas" />
                                    <![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_RIKSCONSE").style.display = 'none';
                      </script>]]>                  
                    </label>
            </field>

            <!--Link hacia caracteristicas-->
            <section id="caracteristicas" visible="true" required="false">
               <label>
                  <message key="riskInstance.caracteristicas.section.Link.txt" />

               </label>
                <validation test="if (TEMP.RIKSCARACTERISTICAS_VALID gt 0,false,true)">
                  <errmsg ><message key="riskInstance.field.caracteristicas.displayName.txt" /></errmsg> 
               </validation>
              <validation test="TEMP.ValidaEstadoCar_ EQ 'E' " >
              <errmsg><message key="errors.ValidaEstadoCar_.links.txt"><param value="ValidaEstadoCar" /></message></errmsg>
              </validation>    
                <if test="TEMP.impactReadOnly eq 'APPROVED2'">
                   <field name="caract" type="component" component-name="LinkedBusinessObjects" readonly=" true ">
                      <param name="linkTypeSourceSystemCd" value="'MON'" />
                      <param name="linkTypeId" value="'x_potential_x_customObject6'" />
                      
              <!-- Filtra Elemendos Desactivados-->
              
                    
                  <on-change>
                       <set-value name="RiksCaracteristicas" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject6'))" />                               
                  </on-change>                   
                   </field>
                </if>           
                <if test="TEMP.impactReadOnly ne 'APPROVED2'">
                   <field name="caract" type="component" component-name="LinkedBusinessObjects" readonly=" isScreenReadOnly() or TEMP.Readonly_Approved  ">
                      <param name="linkTypeSourceSystemCd" value="'MON'" />
                      <param name="linkTypeId" value="'x_potential_x_customObject6'" />
                      
              <!-- Filtra Elemendos Desactivados-->
              
                    <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                    <param name="a:filterExpression">x_activado=YES</param>
                  <on-change>
                       <set-value name="RiksCaracteristicas" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject6'))" />                               
                  </on-change>                   
                   </field>
                </if>  
            </section>     
                    <!-- validaciÃ³n de estados de las  caracteristicas-->
              <field name="ValidaEstadoCar" type="string"  default="'0'">
                          <label>
                             <message key="riskInstance.ValidaEstadoCar.title.txt" />
                          </label>       

              </field>            
      

                <!--  valido si existen  PATRONES  DE COMPORTAMIENTO  asociadas antes de enviar --> 
            <field name="TEMP.RIKSPAT_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                      if($("#PotentialImpact_VALIDAESTADOCAR")!="" && $("#PotentialImpact_VALIDAESTADOCAR") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOCAR").css("display","none")
                        }
                         document.getElementById("PotentialImpact_TEMP.RIKSPAT_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existen  PATRONES  DE COMPORTAMIENTO  asociadas antes de enviar" />
                  </label>

            </field>

            <!--Link hacia patron de comportamiento-->
          <field name="RiksPat" type="string" visible="true">
               <label>
                  <message key="todos los patrones" />
                                    <![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_RIKSCARACTERISTICAS").style.display = 'none';

                      </script>]]>                  
                    </label>
            </field>

            <section id="PatComportamiento" visible="true" required="false">
               <label>
                  <message key="riskInstance.PatComportamiento.section.Link.txt" />                 
               </label>
                <validation test="if (TEMP.RIKSPAT_VALID gt 0,false,true)">
                  <errmsg ><message key="riskInstance.field.RiksPat.displayName.txt " /></errmsg> 
               </validation>
              <validation test="TEMP.ValidaEstadoPtr_ EQ 'E' " >
              <errmsg><message key="errors.ValidaEstadoPtr_.links.txt"><param value="ValidaEstadoPtr" /></message></errmsg>
              </validation> 
              <if test="TEMP.impactReadOnly eq 'APPROVED2'">
                <field  name="patron" type="component" component-name="LinkedBusinessObjects" readonly="true ">
                  <param name="linkTypeSourceSystemCd" value="'MON'" />
                  <param name="linkTypeId" value="'x_potential_x_customObject7'" />
                  
          <!-- Filtra Elemendos Desactivados-->
          
                <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                 <param name="a:filterExpression">x_activado=YES</param>
              <on-change>
                   <set-value name="RiksPat" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject7'))" />                               
              </on-change>                   
               </field>
              </if>               
              <if test="TEMP.impactReadOnly ne 'APPROVED2'">
                <field  name="patron" type="component" component-name="LinkedBusinessObjects" readonly="isScreenReadOnly() or TEMP.Readonly_Approved ">
                  <param name="linkTypeSourceSystemCd" value="'MON'" />
                  <param name="linkTypeId" value="'x_potential_x_customObject7'" />
                  
          <!-- Filtra Elemendos Desactivados-->
          
                <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                 <param name="a:filterExpression">x_activado=YES</param>

              <on-change>
                   <set-value name="RiksPat" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject7'))" />                               
              </on-change>                   
               </field>
              </if>   
            </section>
                      <!-- validaciÃ³n de estados de los patrones de comportamientos-->
              <field name="ValidaEstadoPtr" type="string"  default="'0'">
                          <label>
                             <message key="riskInstance.ValidaEstadoPtr.title.txt" />
                          </label>       

              </field>     

            <field name="Riskatributos" type="textarea" visible="true">
               <label>
                  <message key="Atributos a procesar" />
                                   <![CDATA[<script language="JavaScript">
                      if($("#PotentialImpact_VALIDAESTADOPTR")!="" && $("#PotentialImpact_VALIDAESTADOPTR") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOPTR").css("display","none")
                        }
                         document.getElementById("PotentialImpact_RIKSPAT").style.display = 'none';
                      </script>]]>                   
                    </label>

            </field>

            <!--  valido si existen  Atributos  asociadas antes de enviar --> 
            <field name="TEMP.RIKSAT_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RIKSAT_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si existen Atributos asociadas antes de enviar" />
                  </label>

            </field>

            <!-- valido si seleccionaron atributos para la valorizaciÃ³n-->
            <field name="TEMP.RISKATRIBUTOS_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKATRIBUTOS_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si seleccionaron atributos para la valorizaciÃ³n" />
                  </label>
            </field>

            <!-- valido si a seleccionado al menos un atributo para el subObjeto-->

            <!-- variable a utiliza  RISKATRIBUTOS -->
            <field name="TEMP.RISKATRIBUTOSTPO_VALID" type="string">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKATRIBUTOSTPO_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si a seleccionado al menos un atributo para el subObjeto" />
                  </label>
            </field>

              <validation test="empty(TEMP.RISKATRIBUTOSTPO_VALID)" >
              <errmsg><message key="errors.TEMP.RISKATRIBUTOSTPO_VALID.txt"><param value="TEMP.RISKATRIBUTOSTPO_VALID" /></message></errmsg>
              </validation> 

            <field name="TEMP.RISKATRIBUTOSELECT_VALID" type="string">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKATRIBUTOSELECT_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si a seleccionado al menos un atributo para el subObjeto" />
                  </label>
            </field>
<!--
              <validation test="empty(TEMP.RISKATRIBUTOSELECT_VALID)" >
              <errmsg><message key="errors.TEMP.RISKATRIBUTOSELECT_VALID.txt"><param value="TEMP.RISKATRIBUTOSELECT_VALID" /></message></errmsg>
              </validation> 
-->



            <!--Link hacia Atributo-->
            <field name="RiksAt" type="string" visible="true">
               <label>
                  <message key="todos los atributos" />
                    </label>
            </field>

            <section id="LinkAtributo" visible="true" required="false">
               <label>
                  <message key="riskInstance.LinkAtributo.section.Link.txt" />                   
               </label>

                <validation test="if (TEMP.RIKSAT_VALID gt 0,false,true)">
                  <errmsg ><message key="riskInstance.field.LinkAtributo.displayName.txt" /></errmsg> 
               </validation>
              <validation test="TEMP.ValidaEstadoAt_ EQ 'E' " >
              <errmsg><message key="errors.ValidaEstadoAt_.links.txt"><param value="ValidaEstadoAt" /></message></errmsg>
              </validation> 
                <validation test="if (TEMP.RISKATRIBUTOS_VALID gt 0,false,true)">
                  <errmsg ><message key="errors.RISKATRIBUTOS_VALID.links.txt"/></errmsg> 
               </validation>
   <if test="TEMP.impactReadOnly eq 'APPROVED2'">
                 <field type="component" name="TEMP.related_models" component-name="LinkedBusinessObjects" readonly="true "  >
                     <param name="linkTypeSourceSystemCd">MON</param>
                     <param name="linkTypeId">x_potential_x_customObject1</param>
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                 <param name="a:filterExpression">x_activado=YES</param>
                 
               <on-change>
                   <set-value name="RiksAt" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject1'))" />                                                                                                                                                            
              </on-change>      
             </field>

   </if>

   <if test="TEMP.impactReadOnly ne 'APPROVED2'">
                 <field type="component" name="TEMP.related_models" component-name="LinkedBusinessObjects" readonly="isScreenReadOnly() or TEMP.Readonly_Approved "  >
                     <param name="linkTypeSourceSystemCd">MON</param>
                     <param name="linkTypeId">x_potential_x_customObject1</param>
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                 <param name="a:filterExpression">x_activado=YES</param>
                 
               <on-change>
                   <set-value name="RiksAt" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject1'))" />                                                                                                                                                            
              </on-change>      
             </field>

   </if>

            </section>

            <!-- validaciÃ³n de estados de los atributos-->
              <field name="ValidaEstadoAt" type="string"  default="'0'">
                          <label>
                             <message key="riskInstance.ValidaEstadoAt.title.txt" />
                          </label>       

              </field>  


            <field name="RiskObj" type="string" visible="true">
               <label>
                  <message key="todos los Objetos" />
                                   <![CDATA[<script language="JavaScript">

                      if($("#PotentialImpact_VALIDAESTADOAT")!="" && $("#PotentialImpact_VALIDAESTADOAT") != undefined ){
                          $("#PotentialImpact_VALIDAESTADOAT").css("display","none")
                        }
                         document.getElementById("PotentialImpact_RISKATRIBUTOS").style.display = 'none';
                         document.getElementById("PotentialImpact_RIKSAT").style.display = 'none';
                      </script>]]>                   
                    </label>

            </field>

            <!-- tabla atributoData -->
  <section id="atributoData" expanded="true">
           <field name="TEMP.WWvalid" type="string"   readonly="true"  >
                 <label>
                                  <![CDATA[
                                    <!DOCTYPE html>
                    <!--cargamos  JUERY-->
                  <head>
                      <link rel="stylesheet" type="text/css" href="/egrc/css/dataTables.bootstrap.min.css">

                      <link rel="stylesheet" type="text/css" href="/egrc/css/fixedColumns.bootstrap.min.css">

                      <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery.dataTables.min.js">
                      </script>
                      <script type="text/javascript" language="javascript" src="/egrc/scripts/dataTables.bootstrap.min.js">
                      </script>
                      <script type="text/javascript" language="javascript" src="/egrc/scripts/dataTables.fixedColumns.min.js">
                      </script>

                      <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
                      </script>
                      <script type="text/javascript" language="javascript" src="/egrc/scripts/RiskPat.js">
                      </script>
                  </head>

                  <div class="container2">




                  <div class="container" ID="tablaAtributos" >
                    <script type="text/javascript">
                      
                       /*elimino dimension*/


                      if (document.querySelector("#RIKSAT") != null){

                          var valueAnterior = document.getElementById("RIKSAT").value;
                          var valueAnteriorObj = document.getElementById("RISKOBJ").value;

                          function cambio() {
                              if (document.getElementById("RIKSAT").value != valueAnterior) {
                                  valueAnterior = document.getElementById("RIKSAT").value;
                                  return true;
                              } else
                                  return false;
                          }
                              function cambioObj() {
                              if (document.getElementById("RISKOBJ").value != valueAnteriorObj) {
                                  valueAnteriorObj = document.getElementById("RISKOBJ").value;
                                  return true;
                              } else
                                  return false;
                          }

                          setInterval(function() {

                    


                              if (cambio()){

                                  
                                  var RISKAT = $("#RIKSAT").val();
                                  var RISKOBJ = $("#RISKOBJ").val();
                                  vout = $("#RISKATRIBUTOS").val()
                                  updatedatos($("#RIKSAT").val(),"1","generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSAT","RIKSAT");
                                  selectBox('tblatb','#RISKATRIBUTOS')

                              };
                              if (cambioObj()){
                                    var RISKAT = $("#RIKSAT").val();
                                    var RISKOBJ = $("#RISKOBJ").val();
                                    vout = $("#RISKATRIBUTOS").val()
                                     updatedatos($("#RIKSAT").val(),"1","generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSAT","#RIKSAT");


                                    var trtcauval = $("#CUSTSTATUSTRAT").val();

                                    /*tabla antigua del tratamiento*/
                                    /*
                                    generatablaTrat(trtcauval,"#tablatratamiento")
                                    selectBoxtratamiento('#RISKTRATAMIENTOS')*/
                                    updatedatos($("#CUSTSTATUSTRAT").val(),"8","BuildPat('"+trtcauval+"')","valueAnteriortrat","#CUSTSTATUSTRAT")
                                    




                                    };

                          }, 100);
                          setTimeout('document.getElementById("RIKSAT").value=valueAnterior', 3000);

                      }



                  </script>
                  </div><td type="text"  style="display: none" ]]>
                  </label>
           </field>
         </section>


            <field name="RiksTipost" type="string" visible="false">
               <label>
                  <message key="todos tratamientos" />
                    </label>
            </field>

            <!--valido si existe fuente externa  antes de enviar  -->
            <field name="TEMP.RISKFUENTEEXTERNA_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKFUENTEEXTERNA_VALID").style.display = 'none';


                      </script>]]>
               <message key="valido si existe fuente externa  antes de enviar " />
               </label>
            </field>

           

            <field name="RiskFuenteExterna" type="textarea" readonly="TEMP.Readonly_Approved">
               <label>
                  <message key="riskInstance.field.RiskFuenteExterna.displayName.txt" />
               </label>
            </field>

        

                


<if test="empty(RiskFuenteExterna)">
  <section id="TablaA" expanded="true">
            <field name="tablaFuenteExterna" type="string" readonly="true" >
               <label>
                  <message key="riskInstance.field.TEMP.tablaFuenteExterna.displayName.txt" />
                  <![CDATA[
                  
                  <link rel="stylesheet" type="text/css" href="/egrc/css/BuilderTables.css">

                      <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
                  </script>
                  <style type="text/css">
                   /* fila base oculta */
                   .fila-base{ display: none; }
                   </style>
                  <script type="text/javascript">

                  //document.getElementById("CustomObject7_CUSTOBJ7ATRIBUTOSSTR").style.display = 'none';
                  $(function(){
                      // Clona la fila oculta que tiene los campos base, y la agrega al final de la tabla
                                        
                      $(document).on("click","#tablaFuenteExternaDin .agregar",function(){
                         var cant = validaCantidad("#tablaFuenteExternaDin tbody","#mensajetablaWarningEx","#mensajeExterno");
                          if(cant == true) return;
                          $("#tablaFuenteExternaDin tbody tr:eq(0)").clone().removeClass('fila-base').appendTo("#tablaFuenteExternaDin tbody");

                            $("#tablaFuenteExternaDin .form-control" ).on('keyup', function(){
                             CuentaRegistro(this,"#tablaFuenteExternaDin tbody","#mensajetablaWarningEx","#mensajeExterno");
                             }).keyup();              

                      });
                   
                      // Evento que selecciona la fila y la elimina 
                      $(document).on("click",".eliminar",function(){
                          if ( $('table tbody tr').length == 1 ) return;
                          var parent = $(this).parents().get(0);

                          $(parent).remove();
                      });
                  });
                   

                 
                  var cantidadRegistros = document.querySelectorAll("table tbody tr").length;
                  </script>

                  <div class="container">
                  <table id="tablaFuenteExternaDin" class="table table-striped table-bordered table-hover " cellspacing="0" width="100%">
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr >
                              <th class="info">Fuente externa</th>
                              <th class="info">DescripciÃ³n</th>
                              <th class="info">Disponible en los sistemas SII</th>
                              <th class="agregar"  width="100%"  value="Agregar fila">Agregar</th>
                      </thead>
                   
                      <!-- Cuerpo de la tabla con los campos -->
                      <tbody>
                   
                          <!-- fila base para clonar y agregar al final -->


                          <tr class="fila-base">
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese fuente externa"></textarea></td>
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese DescripciÃ³n"></textarea></td>
                              <td>
                                  <select class="form-control">
                                      <option value="si">si</option>
                                      <option value="no">no</option>
                                  </select>
                              </td>
                              <td class="eliminar" width="100%"  value="Eliminar fila">Eliminar 

                              </td>
                              </td>
                          </tr>


                          <tr class="">
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese fuente externa"></textarea></td>
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese DescripciÃ³n"></textarea></td>
                              <td>
                                  <select class="form-control">
                                      <option value="si">si</option>
                                      <option value="no">no</option>
                                  </select>
                              </td>
                              <td class="eliminar"  value="Eliminar fila">Eliminar 

                              </td>
                              </td>
                          </tr>

                      </tbody>
                  </table>

                    <script type="text/javascript">


    window.onload = (function(){
    try{
        $("#tablaFuenteExternaDin .form-control" ).on('keyup', function(){
        CuentaRegistro(this,"#tablaFuenteExternaDin tbody","#mensajetablaWarningEx","#mensajeExterno");
        }).keyup();
    }catch(e){}});

                    </script>

                  </div>                  
                  <div class="container" id ="TablaAtributosA">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningEx" cellspacing="0" width="100%">
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr id="mensajeExterno" >
                              
                          </tr>                         
                      </thead>
                  </table>
                  </div><td type="text"  style="display: none" 
                  ]]>

               </label>

            </field>
</section>
</if>

<if test="not empty(RISKFUENTEEXTERNA) and TEMP.impactStatusCd ne 'APPROVED2'">
            <section id="TablaA2" expanded="true">
            <field name="tablaFuenteExterna" type="string" readonly="true" >
               <label>
                  <message key="riskInstance.field.TEMP.tablaFuenteExterna.displayName.txt" />
                  <![CDATA[

                  <link rel="stylesheet" type="text/css" href="/egrc/css/BuilderTables.css">
                      <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
                  </script>
                  <style type="text/css">
                   /* fila base oculta */
                   .fila-base{ display: none; }
                  </style>
                  <script type="text/javascript">
                   
                  document.getElementById("PotentialImpact_RISKFUENTEEXTERNA").style.display = 'none';
                  $(function(){
                      // Clona la fila oculta que tiene los campos base, y la agrega al final de la tabla
                                
          
                      $(document).on("click","#tablaFuenteExternaDin .agregar",function(){
                         var cant = validaCantidad("#tablaFuenteExternaDin tbody","#mensajetablaWarningEx","#mensajeExterno");
                          if(cant == true) return;
                          $("#tablaFuenteExternaDin tbody tr:eq(0)").clone().removeClass('fila-base').appendTo("#tablaFuenteExternaDin tbody");
                          $("#tablaFuenteExternaDin .form-control" ).on('keyup', function(){
                           CuentaRegistro(this,"#tablaFuenteExternaDin tbody","#mensajetablaWarningEx","#mensajeExterno");
                           }).keyup();              

                      });
                   
                      // Evento que selecciona la fila y la elimina 
                      $(document).on("click",".eliminar",function(){
                          if ( $('table tbody tr').length == 1 ) return;
                          var parent = $(this).parents().get(0);

                          $(parent).remove();
                      });
                  });

                  var cantidadRegistros = document.querySelectorAll("table tbody tr").length;
                  </script>

                    <div class="container" id ="TablaAtributosA">
                    </div>
                  <div class="container">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningEx" cellspacing="0" width="100%" style="display:none" >
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr id="mensajeExterno" >
                              
                          </tr>
                      </thead>
                  </table>
                  </div>
                    <script type="text/javascript">


                    if (document.querySelector("#RISKFUENTEEXTERNA") == null){
                    val = $(document.querySelector("#RISKFUENTEEXTERNA_fldVal")).find("div").text();
                      armaTabla("#TablaAtributosA",val,['Fuente externa','Ingrese fuente externa','DescripciÃ³n','Ingrese DescripciÃ³n','Disponible en los sistemas SII'],"tablaFuenteExternaDin");
                          window.onload = (function(){
                          try{
                              $(".form-control" ).on('keyup', function(){
                               CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                             }).keyup();
                          }catch(e){}});

                          tableLockedriskB("#TablaAtributosA",val,"tablaFuenteExternaDin");

                    }else {
                        val =$($(document.querySelector("#RISKFUENTEEXTERNA"))[0]).val();
                        armaTabla("#TablaAtributosA",val,['Fuente externa','Ingrese fuente externa','DescripciÃ³n','Ingrese DescripciÃ³n','Disponible en los sistemas SII'],"tablaFuenteExternaDin");
                        window.onload = (function(){
                        try{
                            $(".form-control" ).on('keyup', function(){
                             CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                           }).keyup();
                        }catch(e){}});
                    }



                    </script>
                  <div class="container" id ="TablaAtributosA">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningEx" cellspacing="0" width="100%">
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr id="mensajeExterno" >
                              
                          </tr>                         
                      </thead>
                  </table>
                  </div><td type="text"  style="display: none" 
                    ]]>

               </label>

            </field>
          </section>
</if>
            <!--valido si existe fuentes internas  antes de enviar  -->
            <field name="TEMP.RISKFUENTEINTERNA_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKFUENTEINTERNA_VALID").style.display = 'none';
                          document.getElementById("PotentialImpact_RISKFUENTEEXTERNA").style.display = 'none';


                      </script>]]>
               <message key="valido si existe fuentes internas  antes de enviar  " />
               </label>
            </field>







            <field name="RiskFuenteInterna" type="textarea" readonly="TEMP.Readonly_Approved">
               <label>
                  <message key="riskInstance.field.RiskFuenteInterna.displayName.txt" />
               </label>
            </field>
<if test="empty(RiskFuenteInterna)">
  <section id="TablaB" expanded="true">
            <field name="tablaFuenteInterna" type="string" readonly="true" >
               <label>
                  <message key="riskInstance.field.TEMP.tablaFuenteInterna.displayName.txt" />
                  <![CDATA[
                  


                  <link rel="stylesheet" type="text/css" href="/egrc/css/BuilderTables.css">

                      <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
                  </script>
                  <style type="text/css">
                   /* fila base oculta */
                   .fila-base{ display: none; }
                   </style>
                  <script type="text/javascript">


                   
                  document.getElementById("PotentialImpact_RISKFUENTEINTERNA").style.display = 'none';
                  $(function(){
                      // Clona la fila oculta que tiene los campos base, y la agrega al final de la tabla
                                        
                      $(document).on("click","#tablaFuenteInternaDin .agregar",function(){
                         var cant = validaCantidad("#tablaFuenteInternaDin tbody","#mensajetablaWarningiN","#mensajeInterna");
                          if(cant == true) return;
                          $("#tablaFuenteInternaDin tbody tr:eq(0)").clone().removeClass('fila-base').appendTo("#tablaFuenteInternaDin tbody");
                          $("#tablaFuenteInternaDin .form-control" ).on('keyup', function(){
                           CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarningiN","#mensajeInterna");
                           }).keyup();              

                      });
                   
                      // Evento que selecciona la fila y la elimina 
                      $(document).on("click",".eliminar",function(){
                          if ( $('table tbody tr').length == 1 ) return;
                          var parent = $(this).parents().get(0);

                          $(parent).remove();
                      });
                  });
                   

                 
                  var cantidadRegistros = document.querySelectorAll("table tbody tr").length;
                  </script>

                  <div class="container">
                  <table id="tablaFuenteInternaDin" class="table table-striped table-bordered table-hover " cellspacing="0" width="100%">
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr >
                              <th class="info">Fuente interna</th>
                              <th class="info">DescripciÃ³n</th>
                              <th class="info">Disponible en los sistemas SII</th>
                              <th class="agregar"  width="100%"  value="Agregar fila">Agregar</th>
                      </thead>
                   
                      <!-- Cuerpo de la tabla con los campos -->
                      <tbody>
                   
                          <!-- fila base para clonar y agregar al final -->


                          <tr class="fila-base">
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese fuente interna"></textarea></td>
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese DescripciÃ³n"></textarea></td>
                              <td>
                                  <select class="form-control">
                                      <option value="si">si</option>
                                      <option value="no">no</option>
                                  </select>
                              </td>
                              <td class="eliminar" width="100%"  value="Eliminar fila">Eliminar 

                              </td>
                              </td>
                          </tr>


                          <tr class="">
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese fuente interna"></textarea></td>
                              <td><textarea class="form-control" style="resize: vertical;" placeholder="Ingrese DescripciÃ³n"></textarea></td>
                              <td>
                                  <select class="form-control">
                                      <option value="si">si</option>
                                      <option value="no">no</option>
                                  </select>
                              </td>
                              <td class="eliminar"  value="Eliminar fila">Eliminar 

                              </td>
                              </td>
                          </tr>

                      </tbody>
                  </table>

                    <script type="text/javascript">

    window.onload = (function(){
    try{
        $("#tablaFuenteInternaDin .form-control" ).on('keyup', function(){
        CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarningiN","#mensajeInterna");
        }).keyup();
    }catch(e){}});

                    </script>

                  </div>                  
                  <div class="container">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningiN" cellspacing="0" width="100%">
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr id="mensajeInterna" >
                             
                          </tr>                         
                      </thead>
                  </table>
                  </div><td type="text"  style="display: none" 
                  ]]>

               </label>

            </field>
</section>
</if>

<if test="not empty(RiskFuenteInterna) and TEMP.impactStatusCd ne 'APPROVED2'">
            <section id="Tablab" expanded="true">
            <field name="tablaFuenteInterna" type="string" readonly="true" >
               <label>
                  <message key="riskInstance.field.TEMP.tablaFuenteInterna.displayName.txt" />
                  <![CDATA[

                  <link rel="stylesheet" type="text/css" href="/egrc/css/BuilderTables.css">

                      <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
                  </script>
                  <style type="text/css">
                   /* fila base oculta */
                   .fila-base{ display: none; }
                  </style>
                  <script type="text/javascript">
                   
                  document.getElementById("PotentialImpact_RISKFUENTEINTERNA").style.display = 'none';
                  $(function(){
                      // Clona la fila oculta que tiene los campos base, y la agrega al final de la tabla
                                
          
                      $(document).on("click","#tablaFuenteInternaDin .agregar",function(){
                         var cant = validaCantidad("#tablaFuenteInternaDin tbody","#mensajetablaWarningiN","#mensajeInterna");
                          if(cant == true) return;
                          $("#tablaFuenteInternaDin tbody tr:eq(0)").clone().removeClass('fila-base').appendTo("#tablaFuenteInternaDin tbody");
                          $("#tablaFuenteInternaDin .form-control" ).on('keyup', function(){
                           CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarningiN","#mensajeInterna");
                           }).keyup();              

                      });
                   
                      // Evento que selecciona la fila y la elimina 
                      $(document).on("click",".eliminar",function(){
                          if ( $('table tbody tr').length == 1 ) return;
                          var parent = $(this).parents().get(0);

                          $(parent).remove();
                      });
                  });

                  var cantidadRegistros = document.querySelectorAll("table tbody tr").length;
                  </script>

                    <div class="container" id ="TablaAtributosB">
                    </div>
                    <script type="text/javascript">

                    if (document.querySelector("#RISKFUENTEINTERNA") == null){
                    val = $(document.querySelector("#RISKFUENTEINTERNA_fldVal")).find("div").text();
                      armaTabla("#TablaAtributosB",val,'','tablaFuenteInternaDin');
                          window.onload = (function(){
                          try{
                              $(".form-control" ).on('keyup', function(){
                               CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                             }).keyup();
                          }catch(e){}});
                          tableLockedriskB("#TablaAtributosB",val,"tablaFuenteInternaDin");

                    }else {
                        val =$($(document.querySelector("#RISKFUENTEINTERNA"))[0]).val();
                        armaTabla("#TablaAtributosB",val,'','tablaFuenteInternaDin');
                        window.onload = (function(){
                        try{
                            $(".form-control" ).on('keyup', function(){
                             CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                           }).keyup();
                        }catch(e){}});
                    }

                    </script>
                  <div class="container">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningiN" cellspacing="0" width="100%">
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr id="mensajeInterna" >
                             
                          </tr>                         
                      </thead>
                  </table>
                  </div><td type="text"  style="display: none" 
                    ]]>

               </label>

            </field>
          </section>
</if>


<if test="TEMP.impactStatusCd eq 'APPROVED2'">
   <section id="Tablac" expanded="true">
            <field name="tablaFuenteExterna" type="string" readonly="true" >
               <label>
                  <message key="riskInstance.field.TEMP.tablaFuenteExterna.displayName.txt" />
                  <![CDATA[

         
                      <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
                  </script>


                    <div class="container" id ="TablaAtributosA">
                    </div>
                  <div class="container">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningEx" cellspacing="0" width="100%" style="display:none" >
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr >
                              <th class="alert alert-warning" width="100%"   >Nombre parÃ¡metro y DescripciÃ³n parÃ¡metro deben ser ingresados</th>
                          </tr>
                      </thead>
                  </table>
                  </div>

                    <script type="text/javascript">
                    $("#PotentialImpact_RISKFUENTEEXTERNA").css("display","none")
                      if (document.querySelector("#RISKFUENTEEXTERNA") == null){
                      


                        val = $(document.querySelector("#RISKFUENTEEXTERNA_fldVal")).find("div").text();
                        armaTabla("#TablaAtributosA",val,['Fuente externa','Ingrese fuente externa','DescripciÃ³n','Ingrese DescripciÃ³n','Disponible en los sistemas SII'],"tablaFuenteExternaDin");
                          window.onload = (function(){
                          try{
                              $(".form-control" ).on('keyup', function(){
                               CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                             }).keyup();
                          }catch(e){}});

                          tableLockedriskB("#TablaAtributosA",val,"tablaFuenteExternaDin");

                          window.onload = (function(){
                          try{
                              $(".form-control" ).on('keyup', function(){
                               CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                             }).keyup();
                          }catch(e){}});

                    }else {
                        val =$($(document.querySelector("#RISKFUENTEEXTERNA"))[0]).val();
                        armaTabla("#TablaAtributosA",val,['Fuente externa','Ingrese fuente externa','DescripciÃ³n','Ingrese DescripciÃ³n','Disponible en los sistemas SII'],"tablaFuenteExternaDin");
                        tableLockedriskB("#TablaAtributosA",val,"tablaFuenteExternaDin");
                        window.onload = (function(){
                        try{
                            $(".form-control" ).on('keyup', function(){
                             CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                           }).keyup();
                        }catch(e){}});
                    }




                    
                    </script>
                    <td type="text"  style="display: none" 
                    ]]>

               </label>

            </field>
          </section>
          <section id="Tablad" expanded="true">
            <field name="tablaFuenteInterna" type="string" readonly="true" >
               <label>
                  <message key="riskInstance.field.TEMP.tablaFuenteInterna.displayName.txt" />
                  <![CDATA[


                   
                  <div class="container" id ="TablaAtributosB">
                    </div>
                  <div class="container">
                  <table  class="table table-borderless table-condensed table-hover "  id="mensajetablaWarningiN" cellspacing="0" width="100%" style="display:none" >
                      <!-- Cabecera de la tabla -->
                      <thead>
                          <tr >
                              <th class="alert alert-warning" width="100%"   >Nombre parÃ¡metro y DescripciÃ³n parÃ¡metro deben ser ingresados</th>
                          </tr>
                      </thead>
                  </table>
                  </div>



                    <script type="text/javascript">
                      document.getElementById("PotentialImpact_RISKFUENTEINTERNA").style.display = 'none';

                    if (document.querySelector("#RISKFUENTEINTERNA") == null){
                    val = $(document.querySelector("#RISKFUENTEINTERNA_fldVal")).find("div").text();
                      armaTabla("#TablaAtributosB",val,'','tablaFuenteInternaDin');
                      tableLockedriskB("#TablaAtributosB",val,"tablaFuenteInternaDin");
                          window.onload = (function(){
                          try{
                              $(".form-control" ).on('keyup', function(){
                               CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                             }).keyup();
                          }catch(e){}});
                          tableLockedriskB("#TablaAtributosB",val,"tablaFuenteInternaDin");

                    }else {
                        val =$($(document.querySelector("#RISKFUENTEINTERNA"))[0]).val();
                        armaTabla("#TablaAtributosB",val,'','tablaFuenteInternaDin');
                        tableLockedriskB("#TablaAtributosB",val,"tablaFuenteInternaDin");
                        window.onload = (function(){
                        try{
                            $(".form-control" ).on('keyup', function(){
                             CuentaRegistro(this,"#tablaFuenteInternaDin tbody","#mensajetablaWarning","#mensaje");
                           }).keyup();
                        }catch(e){}});
                    }
                   
                

                    </script>
                    <td type="text"  style="display: none" 
                    ]]>

               </label>

            </field>
          </section>          
</if>

            <section id="Infonoedit" expanded="true">
               <field name="riskFhcDt" type="string" readonly="true">
                  <label>
                     <message key="riskInstance.field.riskFhcDt.displayName.txt" />
                  </label>
               </field>
               <!--Version del riesgo especifico-->
               <field name="riskVersNum" type="number" default="0" readonly="true">
                  <label>
                     <message key="riskInstance.field.riskVersNum.displayName.txt" />
                  </label>
               </field>
               <!--Nombre del riesgo especifico-->
               <field name="riskCreadorRisk" type="string" readonly="true">
                  <label>
                     <message key="customObject4.field.custobj4CreadorStr.displayName.txt" />
                  </label>
               </field>
                <!-- nombre creador sp--> 
                <field name="TEMP.NombreMC" type="string" readonly="true">
                  <label>
                     <message key="field.NombreMC.displayName.txt" />
                     <![CDATA[ 
                     <script type="text/javascript" language="javascript" src="/egrc/scripts/egrc.component.services.js"></script>
                          <script>

                            var rut  = document.querySelectorAll("#RISKCREADORRISK_fldVal")[0].innerText.replace('s',''); 
                            $("#PotentialImpact_RISKCREADORRISK")[0].style.display = 'none'; 
                            getUser(rut);
                        </script>
                       ]]>
                  </label>
               </field>               
               <!-- Rut creador del riesgo especifico-->
               <field name="Cod_rut" type="string" readonly="true">
                  <label>
                     <message key="riskInstance.field.Cod_rut.displayName.txt" />
                  </label>

               </field>
                  <validation test="length(Cod_rut) ne 0">
                   <errmsg ><message key="riskInstance.field.Cod_rut.Error.txt" /></errmsg> 
                  </validation>
               <!--Busco el rut automaticamente-->
               <action-group>
                  <action id="BuscaRut" url="getSASStoredProcessURL()" output-destination="inline" sas-sso="true" content-type="application/x-form-url-encoded" visible="false">
                     <label>
                        <message key="application.search.txt" />
                     </label>
                     <param name="_action" value="'execute,nobanner'" />
                     <param name="_program" value="'/EGRC/STP/busca_usuario'" />
                     <param name="userid" value="TEMP.USUARIO_STP" />
                     <param name="tipoRut" value="if (TEMP.impactStatusCd='CREATE','detalles','valida')" />
                  </action>
               </action-group>
            </section>

         </tab>

        <tab id="sectionTreatments">
              <label>
               <message key="riskInstance.section.Treatments.displayName.txt" />
            </label>


                  <!--  valido si existen  tratamientos  asociadas antes de enviar --> 
                  <field name="TEMP.CUSTSTATUSTRAT_VALID" type="number">
                     <label><![CDATA[<script language="JavaScript">
                               document.getElementById("PotentialImpact_TEMP.CUSTSTATUSTRAT_VALID").style.display = 'none';
                            </script>]]>
                     <message key="valido si existen  tratamientos  asociadas antes de enviar " />
                        </label>

                  </field
      >
                  <!--Link hacia tratamiento-->
                  <section id="LinkTipoTrt" visible="true" required="false">
                     <label>
                        <message key="riskInstance.LinkTipoTrt.section.Link.txt" />                  
                    </label>

                        <validation test="if (TEMP.CUSTSTATUSTRAT_VALID gt 0 ,false,true)">
                         <errmsg ><message key="riskInstance.field.LinkTipoTrt.displayName.txt" /></errmsg> 
                        </validation>

                    <validation test="TEMP.ValidaEstadoTrt_ EQ 'E' " >
                    <errmsg><message key="errors.ValidaEstadoTrt_.links.txt"><param value="ValidaEstadoTrt" /></message></errmsg>
                    </validation> 
   <if test="TEMP.impactReadOnly eq 'APPROVED2'">
                           <field type="component" name="TEMP.related_t" component-name="LinkedBusinessObjects" readonly=" true " >
                           <param name="linkTypeSourceSystemCd">MON</param>
                           <param name="linkTypeId">x_potential_x_customObject8</param>
          <!-- Filtra Elemendos Desactivados-->
          <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                 <param name="a:filterExpression">x_activado=YES</param>
                     
                     <on-change>
                         <set-value name="custStatustrat" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject8'))" />                               
                    </on-change>      
                   </field>
   </if>
      <if test="TEMP.impactReadOnly ne 'APPROVED2'">
                           <field type="component" name="TEMP.related_t" component-name="LinkedBusinessObjects" readonly=" isScreenReadOnly() or TEMP.Readonly_Approved  " >
                           <param name="linkTypeSourceSystemCd">MON</param>
                           <param name="linkTypeId">x_potential_x_customObject8</param>
          <!-- Filtra Elemendos Desactivados-->
          
                     <param name="queryProcessor" value="CreateFilterExpressionQueryProcessor('a')" />
                 <param name="a:filterExpression">x_activado=YES</param>
                     <on-change>
                         <set-value name="custStatustrat" value="C_GetBusinessObjects_2(getLinkInstancesOfType('MON','x_potential_x_customObject8'))" />                               
                    </on-change>      
                   </field>
   </if>


                  </section>

                  <!-- validaciÃ³n de estados de los atributos-->
                    <field name="ValidaEstadoTrt" type="string"  default="'0'">
                                <label>
                                   <message key="riskInstance.ValidaEstadoTrt.title.txt" />
                                </label>       

                    </field>  


                  <field name="custStatustrat" type="string" visible="true">
                     <label>
                        <message key="todos los tratamientos" />
                                         <![CDATA[<script language="JavaScript">
                              if($("#PotentialImpact_VALIDAESTADOTRT")!="" && $("#PotentialImpact_VALIDAESTADOTRT") != undefined ){
                                $("#PotentialImpact_VALIDAESTADOTRT").css("display","none")
                              }
                               document.getElementById("PotentialImpact_RISKOBJ").style.display = 'none';
                            </script>]]>                   
                          </label>

                  </field>

            <!-- valido si por cada nivel se a seleccionado al menos una categoria -->
            <field name="TEMP.PAT_VALID" type="string">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.PAT_VALID").style.display = 'none';
                      </script>]]>
               <message key="valido si por cada nivel se a seleccionado al menos una categoria" />
                  </label>
            </field>

              <validation test="empty(TEMP.PAT_VALID)" >
              <errmsg><message key="errors.TEMP.PAT_VALID.txt"><param value="TEMP.PAT_VALID" /></message></errmsg>
              </validation> 



                  <!-- tabla de PAT -->
                   <section id="PAT" expanded="true">
                  <field name="RISKTRATAMIENTOS" type="textarea" visible="true">
                     <label>
                        <message key="Politica de asignacion de tratamientos" />
                          </label>
                  </field>            
                           <field name="TEMP.tablatratamiento" type="string"   readonly="true"  >
                     <label>
                      <message key="riskInstance.RISKTRATAMIENTOS.section.Link.txt" />
                        <![CDATA[
                          <!DOCTYPE html>
        <head>

            <link rel="stylesheet" type="text/css" href="/egrc/css/dataTables.bootstrap.min.css">

            <link rel="stylesheet" type="text/css" href="/egrc/css/fixedColumns.bootstrap.min.css">

            <script type="text/javascript" language="javascript" src="/egrc/scripts/jquery.dataTables.min.js">
            </script>
            <script type="text/javascript" language="javascript" src="/egrc/scripts/dataTables.bootstrap.min.js">
            </script>
            <script type="text/javascript" language="javascript" src="/egrc/scripts/dataTables.fixedColumns.min.js">
            </script>
            <script type="text/javascript" language="javascript" src="/egrc/scripts/BuilderTables.js">
            </script>
        </head>
                           <div class="container" ID="tablatratamiento" >
                          </div>
                          <script type="text/javascript">  
var _cambio = "";
var cambionum = "";
var cabiotipo = "";

    

      if (document.querySelector("#RIKSAT") != null){
                          var valueAnteriortrat=document.getElementById("CUSTSTATUSTRAT").value; 
                          var valueanteriorRIKSCAUSA=document.getElementById("RIKSCAUSA").value; 
                          var valueanteriorRIKSCONSE=document.getElementById("RIKSCONSE").value; 
                          var valueanteriorRIKSCARACTERISTICAS=document.getElementById("RIKSCARACTERISTICAS").value; 
                          var valueanteriorRIKSPAT=document.getElementById("RIKSPAT").value; 
                          var valueanteriorRIKSAT=document.getElementById("RIKSAT").value;  
                          var valueanteriorRIKSTIPOST=document.getElementById("RIKSTIPOST").value; 
                          var valueanteriorOT=document.getElementById("RIKSOT").value; 
                          var valueanteriorSEG=document.getElementById("RIKSSEG").value; 

                         
                          var itemsObjectCuasa = new Set();
                          var itemsObjectCons = new Set();
                          var itemsObjectCarac = new Set();
                          var itemsObjectPtn = new Set();
                          var itemObjectOt = new Set();
                          var itemAllObj = new  Set ();

                          var ElementoArray =["RIKSCAUSA","RIKSCONSE","RIKSCARACTERISTICAS","RIKSPAT","RIKSOT"];
                          let SetArray =[itemsObjectCuasa,itemsObjectCons,itemsObjectCarac,itemsObjectPtn,itemObjectOt]

                        function cambioin() { 
                              if (document.getElementById("RIKSCAUSA").value!=valueanteriorRIKSCAUSA) {

                                  valueanteriorRIKSCAUSA=document.getElementById("RIKSCAUSA").value;

                                  valorint = $("input#RIKSCAUSA").val()
                                  cargoSet(itemsObjectCuasa,valorint,"Causa");
                                   _cambio = "#RIKSCAUSA";
                                   cambionum = "2";
                                   cabiotipo = "valueanteriorRIKSCAUSA";


                                  return true;
                              }else if (document.getElementById("RIKSCONSE").value!=valueanteriorRIKSCONSE){
                                  valueanteriorRIKSCONSE=document.getElementById("RIKSCONSE").value;

                                  valorint = $("input#RIKSCONSE").val()
                                   cargoSet(itemsObjectCons,valorint,"Consecuencia");
                                    _cambio = "#RIKSCONSE";
                                    cambionum = "5";
                                    cabiotipo = "valueanteriorRIKSCONSE";

                                  return true;
                              }else if (document.getElementById("RIKSCARACTERISTICAS").value!=valueanteriorRIKSCARACTERISTICAS){
                                  valueanteriorRIKSCARACTERISTICAS=document.getElementById("RIKSCARACTERISTICAS").value;
                                valorint = $("input#RIKSCARACTERISTICAS").val()
                                cargoSet(itemsObjectCarac,valorint,"Caracteristicas");
                                 _cambio = "#RIKSCARACTERISTICAS";
                                    cambionum = "6";
                                    cabiotipo = "valueanteriorRIKSCARACTERISTICAS";                                
                                  return true;
                              }else if (document.getElementById("RIKSPAT").value!=valueanteriorRIKSPAT){
                                  valueanteriorRIKSPAT=document.getElementById("RIKSPAT").value;
                                  valorint = $("input#RIKSPAT").val()
                                  cargoSet(itemsObjectPtn,valorint,"PatrÃ³n de comportamiento");
                                    _cambio = "#RIKSPAT";
                                    cambionum = "7";
                                    cabiotipo = "valueanteriorRIKSPAT";                                      
                                  return true;
                              }else if (document.getElementById("RIKSAT").value!=valueanteriorRIKSAT){
                                  valueanteriorRIKSAT=document.getElementById("RIKSAT").value;
                                   _cambio = "#RIKSAT";
                                    cambionum = "1";
                                    cabiotipo = "valueanteriorRIKSAT";                                  
                                  return true;
                              }else if (document.getElementById("RIKSTIPOST").value!=valueanteriorRIKSTIPOST){
                                  valueanteriorRIKSTIPOST=document.getElementById("RIKSTIPOST").value;
                                    _cambio = "#RIKSTIPOST";
                                    cambionum = "8";
                                    cabiotipo = "valueanteriorRIKSTIPOST";                                   
                                  return true;
                              }else if (document.getElementById("RIKSOT").value!=valueanteriorOT){
                                  valueanteriorOT=document.getElementById("RIKSOT").value;
                                    _cambio = "#RIKSOT";
                                    cambionum = "4";
                                    cabiotipo = "valueanteriorOT";                                   
                                  return true;
                              }else if (document.getElementById("RIKSSEG").value!=valueanteriorSEG){
                                  valueanteriorSEG=document.getElementById("RIKSSEG").value;
                                    _cambio = "#RIKSSEG";
                                    cambionum = "3";
                                    cabiotipo = "valueanteriorSEG";                                   
                                  return true;
                              }else {return false; 
                                   _cambio = "";
                                   cambionum = "";
                                   cabiotipo = "";   
                              }

                                   
                          } 


                          function cambiotrat() { 
                              if(document.getElementById("CUSTSTATUSTRAT").value!=valueAnteriortrat) { 
                                  valueAnteriortrat=document.getElementById("CUSTSTATUSTRAT").value; 

                                  return true; 
                              } 
                              else  
                                  return false; 
                          } 
                          function armoElemento(){
                          var elemento = "";
                              for (var i=0;i < ElementoArray.length; i++)
                              { 
                                  if (document.getElementById(ElementoArray[i]).value.length > 0){
                                  elemento += document.getElementById(ElementoArray[i]).value+",";
                                  }

                              }
                              return elemento.substring(0,elemento.length-1);
                          }

                          setInterval( function() { 
                              if( cambiotrat() ) {

                                       document.querySelector("#RISKOBJ").value=armoElemento();
                                       allSet(SetArray)
                                       var trtcauval = $("#CUSTSTATUSTRAT").val();
                                          /*tabla antigua del tratamiento*/
                                          /*
                                          generatablaTrat(trtcauval,"#tablatratamiento")
                                          selectBoxtratamiento('#RISKTRATAMIENTOS')*/
                                           updatedatos($("#CUSTSTATUSTRAT").val(),"8","BuildPat('"+trtcauval+"')","valueAnteriortrat","#CUSTSTATUSTRAT")
          

                                              if(document.querySelector("#CUSTSTATUSTRAT") != undefined){

                                              var CAUTRT = $("#CUSTSTATUSTRAT").val();
                                              var RISKOBJ = $("#RIKSCAUSA").val();
                                              vout = $("#RISKTRTCAUSA").val();
                                              generatabla(CAUTRT,RISKOBJ,  "#tablatrtcausa", "tbltrtcausa",vout,"#RISKTRTCAUSA")
                                              selectBox('tbltrtcausa','#RISKTRTCAUSA')

                                              }else {
                                              var CAUTRT = $("#CUSTSTATUSTRAT_fldVal")[0].childNodes[0].nodeValue;
                                              var RISKOBJ = $("#RIKSCAUSA_fldVal")[0].childNodes[0].nodeValue

                                              ;
                                              vout = $("#RISKTRTCAUSA_fldVal").find("div").text()
                                              generatabla(CAUTRT,RISKOBJ,  "#tablatrtcausa", "tbltrtcausa",vout,"#RISKTRTCAUSA")

                                              }
                                       };
                              if(cambioin()){ 
                                       document.querySelector("#RISKOBJ").value=armoElemento();
                                       allSet(SetArray);                               
                                        var RISKAT = $("#RIKSAT").val();
                                        var RISKOBJ = $("#RISKOBJ").val();
                                        vout = $("#RISKATRIBUTOS").val()

                                        if (_cambio != "#RIKSOT"){
                                           updatedatos($(_cambio).val(),cambionum,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')",cabiotipo,_cambio);
                                          selectBox('tblatb','#RISKATRIBUTOS');
                                        }else{
                                          updatedatos($(_cambio).val(),cambionum,"console.log('actualizo ot')",cabiotipo,_cambio);
                                        }




                                       var trtcauval = $("#CUSTSTATUSTRAT").val();
                                          /*tabla antigua del tratamiento*/
                                          /*
                                          generatablaTrat(trtcauval,"#tablatratamiento")
                                          selectBoxtratamiento('#RISKTRATAMIENTOS')*/
                                          updatedatos($("#CUSTSTATUSTRAT").val(),"8","BuildPat('"+trtcauval+"')","valueAnteriortrat","#CUSTSTATUSTRAT") 
                                          

                                        if(document.querySelector("#CUSTSTATUSTRAT") != undefined){

                                        var CAUTRT = $("#CUSTSTATUSTRAT").val();
                                        var RISKOBJ = $("#RIKSCAUSA").val();
                                        vout = $("#RISKTRTCAUSA").val()
                                        generatabla(CAUTRT,RISKOBJ,  "#tablatrtcausa", "tbltrtcausa",vout,"#RISKTRTCAUSA")
                                        selectBox('tbltrtcausa','#RISKTRTCAUSA')

                                        }else {
                                        var CAUTRT = $("#CUSTSTATUSTRAT_fldVal")[0].childNodes[0].nodeValue;
                                        var RISKOBJ = $("#RIKSCAUSA_fldVal")[0].childNodes[0].nodeValue;
                                        vout = $("#RISKTRTCAUSA_fldVal").find("div").text()
                                            updatedatos($('#CUSTSTATUSTRAT_fldVal')[0].childNodes[0].nodeValue, "8", "generatabla( $('#CUSTSTATUSTRAT_fldVal')[0].childNodes[0].nodeValue,$('#RIKSCAUSA_fldVal')[0].childNodes[0].nodeValue,  '#tablatrtcausa', 'tbltrtcausa',$('#RISKTRTCAUSA_fldVal').find('div').text(),'#RISKTRTCAUSA'); tableLockedRisk ('#tbltrtcausa',2);BuildPat($('#CUSTSTATUSTRAT_fldVal')[0].childNodes[0].nodeValue,'lock')", "valueanteriorRIKSPAT", "#CUSTSTATUSTRAT");
                                        

                                        }
                              };
                          }, 100); 
                          setTimeout('document.getElementById("CUSTSTATUSTRAT").value=valueAnteriortrat',3000);



                          document.querySelector("#RISKOBJ").value=armoElemento();

                          valorint = $("input#RIKSCAUSA").val()
                          cargoSet(itemsObjectCuasa,valorint,"Causa");

                          valorint = $("input#RIKSCONSE").val()
                          cargoSet(itemsObjectCons,valorint,"Consecuencia");
                          
                          valorint = $("input#RIKSCARACTERISTICAS").val()
                          cargoSet(itemsObjectCarac,valorint,"Caracteristicas");

                          valorint = $("input#RIKSPAT").val()
                          cargoSet(itemsObjectPtn,valorint,"PatrÃ³n de comportamiento");
                          itemAllObj.clear();
                          allSet(SetArray);

                    
                          vout = $("#RISKATRIBUTOS").val();

                          var RISKAT = $("#RIKSAT").val();
                          var RISKOBJ = $("#RISKOBJ").val();
                          var vout = $("#RISKATRIBUTOS").val();
/*
                          updatedatos($(_cambio).val(),cambionum ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')",cabiotipo ,_cambio);
                          */

                          updatedatos($("#RIKSAT").val(),"1" ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSAT" ,"#RIKSAT");
                          updatedatos($("#RIKSCAUSA").val(),"2" ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSCAUSA" ,"#RIKSCAUSA");
                          updatedatos($("#RIKSOT").val(),"4" ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorOT" ,"#RIKSOT");
                          updatedatos($("#RIKSCONSE").val(),"5" ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSCONSE" ,"#RIKSCONSE");
                          updatedatos($("#RIKSCARACTERISTICAS").val(),"6" ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSCARACTERISTICAS" ,"#RIKSCARACTERISTICAS");
                          updatedatos($("#RIKSPAT").val(),"7" ,"generatabla($('#RIKSAT').val(), $('#RISKOBJ').val(), '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS').val(),'#RISKATRIBUTOS')","valueanteriorRIKSPAT" ,"#RIKSPAT");

                          updatedatos($("#RIKSSEG").val(),"3" ,"console.log('actualizo segmento')","valueanteriorSEG" ,"#RIKSSEG");





                          var trtcauval = $("#CUSTSTATUSTRAT").val();
                              /*tabla antigua del tratamiento*/
                         /* generatablaTrat(trtcauval ,"#tablatratamiento");*/



                          /*valido si esta aprobado nivel 2*/
                          $(document).ready(function() {
                          if ($("#RISKNOM").val() == undefined){
                          updatedatos($("#CUSTSTATUSTRAT").val(),"8","BuildPat('"+trtcauval+"','lock')","valueAnteriortrat","#CUSTSTATUSTRAT")


                           
                          }else{
                            updatedatos($("#CUSTSTATUSTRAT").val(),"8","BuildPat('"+trtcauval+"')","valueAnteriortrat","#CUSTSTATUSTRAT") 
                          }

                          });
                          







      }else {
                          var itemsObjectCuasa = new Set();
                          var itemsObjectCons = new Set();
                          var itemsObjectCarac = new Set();
                          var itemsObjectPtn = new Set();
                          var itemAllObj = new  Set ();
                          var ElementoArray =["RIKSCAUSA","RIKSCONSE","RIKSCARACTERISTICAS","RIKSPAT"];
                          var SetArray =[itemsObjectCuasa,itemsObjectCons,itemsObjectCarac,itemsObjectPtn]


                          valorint = $("#RIKSCAUSA_fldVal")[0].childNodes[0].nodeValue
                          cargoSet(itemsObjectCuasa,valorint,"Causa");
                          valorint = $("#RIKSCONSE_fldVal")[0].childNodes[0].nodeValue
                          cargoSet(itemsObjectCons,valorint,"Consecuencia");
                          valorint = $("#RIKSCARACTERISTICAS_fldVal")[0].childNodes[0].nodeValue
                          cargoSet(itemsObjectCarac,valorint,"Caracteristicas");
                          valorint = $("#RIKSPAT_fldVal")[0].childNodes[0].nodeValue
                          cargoSet(itemsObjectPtn,valorint,"PatrÃ³n de comportamiento");
                          var RISKAT = $("#RIKSAT_fldVal")[0].childNodes[0].nodeValue;
                          var RISKOBJ = $("#RISKOBJ_fldVal")[0].childNodes[0].nodeValue;
                          vout = $("#RISKATRIBUTOS_fldVal").find("div").text()
                          allSet(SetArray);
                          updatedatos($('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, "1", "generatabla( $('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, $('#RISKOBJ_fldVal')[0].childNodes[0].nodeValue , '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS_fldVal').find('div').text(), '#RISKATRIBUTOS' );tableLockedRisk ('#tblatb',2)", "valueanteriorRIKSAT", "#RIKSAT");
                          updatedatos($('#RIKSCAUSA_fldVal')[0].childNodes[0].nodeValue, "2", "generatabla( $('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, $('#RISKOBJ_fldVal')[0].childNodes[0].nodeValue , '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS_fldVal').find('div').text(), '#RISKATRIBUTOS' );tableLockedRisk ('#tblatb',2)", "valueanteriorRIKSCAUSA", "#RIKSCAUSA");
                          updatedatos($('#RIKSOT_fldVal')[0].childNodes[0].nodeValue, "4", "generatabla( $('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, $('#RISKOBJ_fldVal')[0].childNodes[0].nodeValue , '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS_fldVal').find('div').text(), '#RISKATRIBUTOS' );tableLockedRisk ('#tblatb',2)", "valueanteriorOT", "#RIKSOT");
                          updatedatos($('#RIKSCONSE_fldVal')[0].childNodes[0].nodeValue, "5", "generatabla( $('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, $('#RISKOBJ_fldVal')[0].childNodes[0].nodeValue , '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS_fldVal').find('div').text(), '#RISKATRIBUTOS' );tableLockedRisk ('#tblatb',2)", "valueanteriorRIKSCONSE", "#RIKSCONSE");
                          updatedatos($('#RIKSCARACTERISTICAS_fldVal')[0].childNodes[0].nodeValue, "6", "generatabla( $('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, $('#RISKOBJ_fldVal')[0].childNodes[0].nodeValue , '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS_fldVal').find('div').text(), '#RISKATRIBUTOS' );tableLockedRisk ('#tblatb',2)", "valueanteriorRIKSCARACTERISTICAS", "#RIKSCARACTERISTICAS");
                          updatedatos($('#RIKSPAT_fldVal')[0].childNodes[0].nodeValue, "7", "generatabla( $('#RIKSAT_fldVal')[0].childNodes[0].nodeValue, $('#RISKOBJ_fldVal')[0].childNodes[0].nodeValue , '#tablaAtributos', 'tblatb',$('#RISKATRIBUTOS_fldVal').find('div').text(), '#RISKATRIBUTOS' );tableLockedRisk ('#tblatb',2)", "valueanteriorRIKSPAT", "#RIKSPAT");

                          
                          var trtcauval = $("#CUSTSTATUSTRAT_fldVal")[0].childNodes[0].nodeValue;
                         
                          /*TABLA ANTIGUA DEL PAT*
                       /*   generatablaTrat(trtcauval,"#tablatratamiento");*/

                        updatedatos($("#CUSTSTATUSTRAT").val(),"8","BuildPat('"+trtcauval+"','lock') ","valueAnteriortrat","#CUSTSTATUSTRAT")                                     

                          
        


      }



        

                          

                          </script>
                        <td type="text"  style="display: none" ]]>
                      
                      </label>
               </field>
       </section>

         <!-- Termina PAT -->

          <!-- tabla de CAUSAS vs TRATAMIENTOS -->
        <section id="CAUSATRATAMIENTO" expanded="true" >
                  <field name="RiskTrtCausa" type="textarea" visible="true">
                     <label>
                        <message key="tratamientos vs causas a procesar" />  
                          </label>
                  </field>           
                  <field name="TEMP.tablatratamiento" type="string"   readonly="true"  >
                     <label>
                      <message key="riskInstance.field.CAUSATRATAMIENTO.displayName.txt" />
                      <![CDATA[
                      <div class="container">
                        <div class="container" ID="tablatrtcausa" >
                        <script type="text/javascript">
                        $("#PotentialImpact_RISKTRTCAUSA").css("display","none")
                        /*genero tabla tratamientos vs causas*/  


                          if(document.querySelector("#CUSTSTATUSTRAT") != undefined){

                          var CAUTRT = $("#CUSTSTATUSTRAT").val();
                          var RISKOBJ = $("#RIKSCAUSA").val();
                          vout = $("#RISKTRTCAUSA").val();
                          generatabla(CAUTRT,RISKOBJ,  "#tablatrtcausa", "tbltrtcausa",vout,"#RISKTRTCAUSA")

                          }else {
                          var CAUTRT = $("#CUSTSTATUSTRAT_fldVal")[0].childNodes[0].nodeValue;
                          var RISKOBJ = $("#RIKSCAUSA_fldVal")[0].childNodes[0].nodeValue;
                          vout = $("#RISKTRTCAUSA_fldVal").find("div").text()
                             updatedatos($('#CUSTSTATUSTRAT_fldVal')[0].childNodes[0].nodeValue, "8", "generatabla( $('#CUSTSTATUSTRAT_fldVal')[0].childNodes[0].nodeValue,$('#RIKSCAUSA_fldVal')[0].childNodes[0].nodeValue,  '#tablatrtcausa', 'tbltrtcausa',$('#RISKTRTCAUSA_fldVal').find('div').text(),'#RISKTRTCAUSA'); tableLockedRisk ('#tbltrtcausa',2);BuildPat($('#CUSTSTATUSTRAT_fldVal')[0].childNodes[0].nodeValue,'lock')", "valueanteriorRIKSPAT", "#CUSTSTATUSTRAT");                          
                          





                          }


          
                        /*si cambian los tratamientos o las causas genero nuevamente la tabla*/
                        </script>
                        </div><td type="text"  style="display: none" ]]>
                
                      </label>
               </field>
       </section>

         <!-- Termina PAT -->
        </tab>

         <!--valorizaciÃ³n-->
        <tab id="valorizacion">
          <label>
            <message key="riskInstance.field.valorizacion.displayName.txt"/>
          </label>
              
          <!--Metodo de calculo-->
               <field name="x_list_mcalc" type="dropdown" values="getNamedListLabelValues('list_mcalc')" required="true" default="'Moda'" readonly="(if (TEMP.Reversa_Risk_status  eq true , true, false)) or TEMP.Readonly_Approved ">
               <label>
                  <message key="riskInstance.x_list_mcalc.field.displayName.txt" />
               </label>
               </field>
          <!--Frecuencia ponderada / modelo de usuario -->
          <column-layout>
               <column>
                  <field name="x_ModProb_op" type="radio" required="true" align="inline"
                  values="GetNamedListLabelValues('list_ModProb')" readonly="(if (TEMP.Reversa_Risk_status  eq true , true, false)) or TEMP.Readonly_Approved">
                  <label><message key="riskInstance.field.list_ModProb.displayName.txt"/></label>
                  <on-change>
                  <set-visible name="TEMP.URL_POR_STP_MOD_US" test="x_ModProb_op eq 'Modelo Usuario' " />
                  <set-visible name="PIselectprocDesc" test="x_ModProb_op eq 'Modelo Usuario' " />
                   <set-visible name="ObtieneProcProb" test="x_ModProb_op eq 'Modelo Usuario' and (TEMP.impactStatusCd eq  'CREATED' or TEMP.impactStatusCd eq  'CREATE'  ) " />
                   <set-visible name="x_list_ejec" test="x_ModProb_op eq 'Modelo Usuario' " />
                   <set-visible name="TEMP.ATRIBUTOSASOC" test="x_ModProb_op eq 'Modelo Usuario' " />
                   <set-visible name="TEMP.RiskFrecPonderada" test = "x_ModProb_op eq 'Frecuencia Ponderada'"/>
                   
                  </on-change>
                  </field>


            <!-- Valido las ponderaciones-->
            <!-- variable a utiliza  RISKPONDATR -->
            <field name="TEMP.RISKPONDERA_VALID" type="string">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.RISKPONDERA_VALID").style.display = 'none';
                      </script>]]>
               <message key="VALIDO PONDERACIONES" />
                  </label>
            </field>

              <validation test="empty(TEMP.RISKPONDERA_VALID)" >
              <errmsg><message key="errors.TEMP.RISKPONDERA_VALID.txt"><param value="TEMP.RISKPONDERA_VALID" /></message></errmsg>
              </validation> 



            <field name="RiskPondAtr" type="textarea" >
              <label>
                           <message key="todas las ponderaciones"/>

              </label>

            </field>                    
            <!-- Frecuencia ponderada-->
            <field name="TEMP.RiskFrecPonderada" type="textarea"  readonly="true" >
                        <label>
                           <message key="riskInstance.field.RiskFrecPonderada.displayName.txt" />
                           <![CDATA[ 

<div id="atributopond" style="margin: 10px 10px 10px 10px">

</div>

<script type="text/javascript">
document.getElementById("PotentialImpact_RISKTRATAMIENTOS").style.display = 'none';
document.getElementById("PotentialImpact_CUSTSTATUSTRAT").style.display = 'none';
let atrpond = new Set();
var tablapondera = new Tbodyfp();

if(document.querySelector("#RISKATRIBUTOS")!=null){
  var temporalfp="";
  var valorIni = document.querySelector("#RISKPONDATR").value.split("|");
  var valfp = $("#RISKATRIBUTOS").val();


}else{
  var temporalfp="";
  var valorIni = $("#RISKPONDATR_fldVal").find("div").text().split("|");
  var valfp = $("#RISKATRIBUTOS_fldVal").find("div").text();
}


tablapondera.contenidoTd=`<th class="info">Atributos asociados</th><th class="info">Ponderador</th>`;
tablapondera.bodyfp2=function (e,atrpond){


  e.forEach(function(valor){
    if(valorIni != ""){
      for (let i = 0; i<valorIni.length ;i++){
        for (let j = 0 ;j < valorIni[i].split(",").length -1 ;j ++){
          if (valorIni[i].split(",")[j] == valor){
            temporalfp +=`<tr><td>${valor}</td><td><input type="number" id="${valor}"step="0.01" name="ancho" class="cambio"   required autofocus value="${valorIni[i].split(",")[j+1]}" /></td></tr>`
          }
        }

      }
    }else{
      temporalfp +=`<tr><td>${valor}</td><td><input type="number" id="${valor}"step="0.01" name="ancho" class="cambio"   required autofocus value="1" /></td></tr>`
    }
  })
  return temporalfp;
};


tablafpatributo(valfp,atrpond,"Consecuencia","#atributopond","atributo3",tablapondera);

if (document.querySelector("#RISKATRIBUTOS")==null){
tableLockedRiskMpA ("#atributo3",1);
}



$(function(){
  $("#atributo3" ).on('input', function(){
    let numero = $(this).val();
    let pondid = `${$(this).attr("id")}`;
    if (numero == "" ){
      document.getElementById(pondid).value=1;
      //armo variable destino
      armovar("#RISKPONDATR","#atributo3 tbody","textarea#RISKPONDATR");
      //
    }else{
      document.getElementById(pondid).value = $(this).val();
      //armo variable destino
      armovar("#RISKPONDATR","#atributo3 tbody","textarea#RISKPONDATR");
      //
    }
    

  });
});


$(".cambio").on('keypress', function(e){
  var keynum = window.event ? window.event.keyCode : e.which; // tecla ingresada
  if (keynum == 46){
    return false;
  }
})

$(".cambio").on('input', function(){
  value = $(this).val();
  if (value.length > 0){
  }else{
    $(this).val('0')  

  }
})
$("#PotentialImpact_RISKPONDATR").css("display","none")
</script>
]]> 
                        </label>  
            </field>
          
             <!--Lista de procesos en el servidor-->
            <field name="TEMP.URL_POR_STP_MOD_US" type="component" component-name="IFrameComponent"  >
               <!-- These params are neverBeenSaveded by the component -->
               <param name="height" value="'400px'" />
               <param name="width" value="'600px'" />
               <param name="url" value="getSASStoredProcessURL()" />
               <param name="_program" value="'/EGRC/STP/egrc_generaListModProb'" />
               <param name="impactRk" value="potentialImpactId" />
            </field>

    
                        <!--Esta o no en ejecucion?-->
            <!--Proceso <seleccionado-->
            <field name="PIselectprocDesc" type="string" length="32" default="'Nada seleccionado...'">
                        <label>
                           <message key="riskInstance.field.PIselectprocDesc.displayName.txt" />
                        </label>  
            
                     </field>
               <field name="x_list_ejec" type="dropdown" values="getNamedListLabelValues('list_Ejec')" readonly="(TEMP.x_list_ejec_status and TEMP.risk_x_list_ejec) or TEMP.Readonly_Approved" >
               <label>
                  <message key="riskInstance.field.x_list_ejecucion.displayName.txt" />
               </label>
               <on-change>
               <set-value name="PIselectprocDesc"
               value="if (x_list_ejec='Desasociar proceso','Nada seleccionado...',PIselectprocDesc)" /> 
               </on-change>
               </field>
<if test="empty(PIselectprocDesc) or PIselectprocDesc eq 'Nada seleccionado...'">               
               <action-group >
                <action id="ObtieneProcProb" url="getSASStoredProcessURL()" output-destination="inline" sas-sso="true" content-type="application/x-form-url-encoded" >
                     <label>
                        <message key="riskInstance.field.ObtieneProcProb.displayName.txt" />
                         <![CDATA[ <script type="text/javascript">

                               if(document.querySelector("#PISELECTPROCDESC") != null){
                                    document.querySelector("#PISELECTPROCDESC").disabled="true";

                               }
                                  if(document.querySelector("#PISELECTPROCDESC") != null && document.querySelector("#X_LIST_EJEC") !=  null){
                                    document.querySelector("#PISELECTPROCDESC").disabled="true"
                                    document.querySelector("#X_LIST_EJEC").addEventListener("change",proejec, false)
                                    if ($("#X_MODPROB_OP").find("input").length > 0){
                                      document.querySelector("#X_MODPROB_OP").addEventListener("change",modus,false)

                                        function modus(){
                                       
                                       let procprob = document.querySelector("#PISELECTPROCDESC").value;
                                       if(document.querySelector("#X_MODPROB_OP_1").checked && procprob == "Nada seleccionado..."){
                                        ocultaEnviar();
                                       }

                                    }

                                    function proejec(){
                                       let procselect =  document.querySelector("#X_LIST_EJEC").value;
                                          if(procselect === "Desasociar proceso"){
                                          ocultaEnviar();
                                       } 
                                     }

                                    function ocultaEnviar (){

                                      for ( var i  in document.querySelectorAll("button")){
                                          if (document.querySelectorAll("button")[i].innerText == "Enviar para su aprobaciÃ³n"){
                                          document.querySelectorAll("button")[i].style.display = "none";
                                          }else if (document.querySelectorAll("button")[i].innerText == "Aprobar"){
                                          document.querySelectorAll("button")[i].style.display = "none";
                                          }

                                       }                                    
                                    }


                                    modus();
                                  }


                                    }

                              
                          </script>
]]> 
                     </label>
                     <param name="_action" value="'execute,nobanner'" />                     
                     <param name="_program" value="'/EGRC/STP/egrc_obtiene_procModProb'" />
                     <param name="impactRk" value="potentialImpactId" />
                  </action>
               </action-group> 
</if>               


            <field name="TEMP.ATRIBUTOSASOC" type="string"   readonly="true"  >
                        <label>
                           <message key="riskInstance.field.ATRIBUTOSASOC.displayName.txt" /> 
    <![CDATA[ 


    <div id = "fpatributo" style="margin: 10px 10px 10px 10px">

    </div>
    <script type="text/javascript">
      //armo variable destino
       armovar("#RISKPONDATR","#atributo3 tbody","textarea#RISKPONDATR");
      //

      limpiaHTML("TEMP.RISKFRECPONDERADA_fldLbl");
      let atrasoc = new Set();
      var tablafpA = new Tbodyfp();

      if(document.querySelector("#RISKATRIBUTOS") == null){
        var valorIni = $("#RISKATRIBUTOS_fldVal").find("div").text();

      }else{
        var valorIni = $("#RISKATRIBUTOS").val();
      }

    tablafpatributo(valorIni,atrasoc,"Consecuencia","#fpatributo","atributo1",tablafpA);
    </script>
    ]]> 

                          
                        </label>  
            
            </field>



               </column>
               <column>
                  <!-- Frecuencia ponderada / modelo de usuario-->

                  <field name="x_ModCons_op" type="radio" required="true" align="inline"
                  values="GetNamedListLabelValues('list_ModCons')" readonly="(if (TEMP.Reversa_Risk_status  eq true , true, false)) or TEMP.Readonly_Approved">
                  <label><message key="riskInstance.field.x_ModCons_op.displayName.txt"/></label>
                  <on-change>
                  <set-visible name="TEMP.URL_POR_STP_MOD_CONS" test="x_ModCons_op eq 'Modelo Usuario' " />
                  <set-visible name="PIselectprocDescCons" test="x_ModCons_op eq 'Modelo Usuario' " />
                  <set-visible name="ObtieneProcCons" test="x_ModCons_op eq 'Modelo Usuario' and (TEMP.impactStatusCd eq  'CREATED' or TEMP.impactStatusCd eq  'CREATE'  ) " />
                  <set-visible name="x_list_ejecCons" test="x_ModCons_op eq 'Modelo Usuario' " />
                  <set-visible name="TEMP.ATRIBUTOCONS" test="x_ModCons_op eq 'Modelo Usuario' " />
                  <set-visible name="TEMP.RiskFpconsecuencia" test="x_ModCons_op eq 'Frecuencia Ponderada' " />
                  </on-change>
                   </field>
            <!--Selecion de atributos-->
            <field name="RiskSelectAtr" type="textarea" >
              <label>
              <message key="consecuencia seleccionada"/>
              </label>

            </field> 

            <!-- Frecuencia ponderada-->
            <field name="TEMP.RiskFpconsecuencia" type="textarea"  readonly="true" >
                        <label>
                           <message key="riskInstance.field.RiskFpconsecuencia.displayName.txt" />
                           <![CDATA[ 


<div id = "atributopondCons" style="margin: 10px 10px 10px 10px" >

</div>
<script type="text/javascript">


  if(document.querySelector("#RISKATRIBUTOS") == null){
  var valorIni = $("#RISKATRIBUTOS_fldVal").find("div").text();
  var valor1 = $("#RISKSELECTATR_fldVal").find("div").text()


}else{
  var valorIni = $("#RISKATRIBUTOS").val();
  var valor1 = $("#RISKSELECTATR").val();
}


let atrpondcons = new Set();

var tablaponderaCons = new Tbodyfp();
tablaponderaCons.contenidoTd=`<th class="info">Atributos asociados</th><th class="info">SelecciÃ³n</th>`;
tablaponderaCons.bodyfp2=function (e){
    let temporalfp="";
    let comodin = 0;
    e.forEach(function(valor){

      if (valor1.length > 0 &&  valor1 == valor ){
            temporalfp +=`<tr><td>${valor}</td><td align="center" ><label><input type="radio" name="optradio" onclick="seleConsAtr(${valor})"  checked="true"></label></td></tr>`
      }else if(valor1 == 0 ) {
      
          if(comodin == 0){
                temporalfp +=`<tr><td>${valor}</td><td align="center" ><label><input type="radio" name="optradio" onclick="seleConsAtr(${valor})" checked="true"  ></label></td></tr>`
                if(document.querySelector("#RISKATRIBUTOS") == null){
                  $("#RISKSELECTATR_fldVal").find("div").text(valor)
                }else{
                  $("#RISKSELECTATR").val(valor);
                }

          comodin++;
          }else{
                      temporalfp +=`<tr><td>${valor}</td><td align="center" ><label><input type="radio" name="optradio" onclick="seleConsAtr(${valor})" ></label></td></tr>`
          }
      } else{
        temporalfp +=`<tr><td>${valor}</td><td align="center" ><label><input type="radio" name="optradio" onclick="seleConsAtr(${valor})" ></label></td></tr>`
      }

    })
     return temporalfp;
  };

tablafpatributo(valorIni,atrpondcons,"SoloConsecuencia","#atributopondCons","atributo4",tablaponderaCons);

if (document.querySelector("#RISKATRIBUTOS") == null){
  tableLockedRiskMpB ("#atributo4",1);
}

limpiaHTML("TEMP.ATRIBUTOSASOC_fldLbl");



</script>
]]> 
                        </label>  
            </field>



                                  <!--Lista de procesos en el servidor-->
            <field name="TEMP.URL_POR_STP_MOD_CONS" type="component" component-name="IFrameComponent"  >
               <!-- These params are neverBeenSaveded by the component -->
               <param name="height" value="'400px'" />
               <param name="width" value="'600px'" />
               <param name="url" value="getSASStoredProcessURL()" />
               <param name="_program" value="'/EGRC/STP/egrc_generaListModCons'" />
               <param name="impactRk" value="potentialImpactId" />
            </field>

            <!--Esta o no en ejecucion?-->
            <!--Proceso <seleccionado-->
                     <field name="PIselectprocDescCons" type="string" length="32" default="'Nada seleccionado...'" required="true">
                        <label>
                           <message key="riskInstance.field.PIselectprocDescCons.displayName.txt" />
                        </label>    

                     </field>

               <field name="x_list_ejecCons" type="dropdown" values="getNamedListLabelValues('list_EjecCons')" readonly="(TEMP.x_list_ejec_status and TEMP.risk_x_list_ejec) or TEMP.Readonly_Approved" >
               <label>
                  <message key="riskInstance.field.x_list_ejecucion.displayName.txt" />
               </label>
               <on-change>
               <set-value name="PIselectprocDescCons"
               value="if (x_list_ejecCons='Desasociar proceso','Nada seleccionado...',PIselectprocDescCons)" /> 
               </on-change>
               </field>

<if test="empty(PIselectprocDescCons) or PIselectprocDescCons eq 'Nada seleccionado...'">

               <action-group >
                  <action id="ObtieneProcCons" url="getSASStoredProcessURL()" output-destination="inline" sas-sso="true" content-type="application/x-form-url-encoded" visible="if(TEMP.impactStatusCd = 'CREATE' or TEMP.impactStatusCd = 'CREATED' ,true ,false)">
                     <label>
                        <message key="riskInstance.field.ObtieneProcCons.displayName.txt" />
                     </label>
                     <param name="_action" value="'execute,nobanner'" />                     
                     <param name="_program" value="'/EGRC/STP/egrc_obtiene_procModCons'" />
                     <param name="impactRk" value="potentialImpactId" />
                  </action>

               </action-group> 
</if>               
<if test="TEMP.impactStatusCd eq 'CREATE' or TEMP.impactStatusCd eq 'CREATED' and isScreenReadOnly() eq false ">
  <field name="TEMP.JavaScriptTEMPlist" type="string" visible="true" hideLabel="true" readonly="true">
    <help-text>



                          <![CDATA[ <script type="text/javascript"> 
                         
                                        function modus() {

                                            let procprob = document.querySelector("#PISELECTPROCDESC").value;
                                            if (document.querySelector("#X_MODPROB_OP_1").checked && procprob == "Nada seleccionado...") {
                                                ocultaEnviar();
                                            }

                                        }

                                        function proejec() {
                                            let procselect = document.querySelector("#X_LIST_EJEC").value;
                                            if (procselect === "Desasociar proceso") {
                                                ocultaEnviar();
                                            }
                                        }

                                        function ocultaEnviar() {

                                            for (var i in document.querySelectorAll("button")) {
                                                if (document.querySelectorAll("button")[i].innerText == "Enviar para su aprobaciÃ³n") {
                                                    document.querySelectorAll("button")[i].style.display = "none";
                                                } else if (document.querySelectorAll("button")[i].innerText == "Aprobar") {
                                                    document.querySelectorAll("button")[i].style.display = "none";
                                                }

                                            }
                                        }

                                        function modusCons() {

                                            let procprob = document.querySelector("#PISELECTPROCDESCCONS").value;
                                            if (document.querySelector("#X_MODCONS_OP_1").checked && procprob == "Nada seleccionado...") {
                                                ocultaEnviar();
                                            }

                                        }

                                        function proejecCons() {
                                            let procselect = document.querySelector("#X_LIST_EJECCONS").value;
                                            if (procselect === "Desasociar proceso") {
                                                ocultaEnviar();
                                            }
                                        }


                                        if (document.querySelector("#PISELECTPROCDESC") != null && document.querySelector("#X_LIST_EJEC") != null) {
                                            document.querySelector("#PISELECTPROCDESC").disabled = "true"
                                            document.querySelector("#X_LIST_EJEC").addEventListener("change", proejec, false)
                                            if ($("#X_MODPROB_OP").find("input").length > 0) {
                                                document.querySelector("#X_MODPROB_OP").addEventListener("change", modus, false)

                                                modus();
                                            }


                                        }

                                        if (document.querySelector("#X_MODCONS_OP") != null && document.querySelector("#X_LIST_EJECCONS") != null) {
                                            document.querySelector("#PISELECTPROCDESCCONS").disabled = "true"

                                            if (document.querySelector("#X_LIST_EJECCONS") != null) {
                                                document.querySelector("#X_LIST_EJECCONS").addEventListener("change", proejecCons, false)

                                            }
                                            document.querySelector("#X_MODCONS_OP").addEventListener("change", modusCons, false)
                                            modusCons();
                                        } else {
                                            if (document.querySelector("#PISELECTPROCDESCCONS") != null) {
                                                document.querySelector("#PISELECTPROCDESCCONS").disabled = "true"
                                            }

                                            

                                        }



                                     </script>
]]> 
    </help-text>
  </field>
</if>  



              <field name="TEMP.ATRIBUTOCONS" type="string"   readonly="true"  >

                        <label>
                           <message key="riskInstance.field.ATRIBUTOCONS.displayName.txt" /> 

<![CDATA[ 

<div  id = "fpconsecuencia" style="margin: 10px 10px 10px 10px">

</div>
<script type="text/javascript">
let atrascons = new Set();
var tablafpc = new Tbodyfp();

if(document.querySelector("#RISKATRIBUTOS") == null){
  var valorIni = $("#RISKATRIBUTOS_fldVal").find("div").text();

}else{
  var valorIni = $("#RISKATRIBUTOS").val();
}

tablafpatributo(valorIni,atrascons,"SoloConsecuencia","#fpconsecuencia","atributo2",tablafpc);
  limpiaHTML("TEMP.RISKFPCONSECUENCIA_fldLbl"); 
document.getElementById("PotentialImpact_RISKPONDATR").style.display = 'none';
document.getElementById("PotentialImpact_RISKSELECTATR").style.display = 'none'; 


                                        if(document.querySelector("#PISELECTPROCDESCCONS") != null){
                                                                                document.querySelector("#PISELECTPROCDESCCONS").disabled="true";

                                          }  
                                          if (document.querySelector("#PISELECTPROCDESC") != null) {
                                                document.querySelector("#PISELECTPROCDESC").disabled = "true"
                                            }
</script>



]]> 
                        
                        </label>  
            
            </field>

               </column>
            </column-layout>
              

         <field name="TEMP.WWvalid" type="string" visible="true" hideLabel="true" readonly="true">
               <label><![CDATA[<script language="JavaScript">


                 // var boton_value =document.getElementsByClassName("button"); 
                    limpiaHTML("TEMP.ATRIBUTOCONS_fldLbl");
/*
                    for (var j=0; j < boton_value.length;j++ ){
                      if (boton_value[j].innerText == "Enviar para su aprobaciÃ³n" ){
                        validocampos(j);

                     }
                    }

*/

                    

                     </script>]]>
               </label>
         </field>

<!-- 
SE AGREGA VALORIZACION EN TM
-->
<if test="isScreenReadOnly() eq false">
   <if test="TEMP.impactStatusCd eq 'CREATE' OR TEMP.impactStatusCd  EQ 'CREATED' OR TEMP.impactStatusCd  EQ 'SUBMITTED'">
      <field name="TEMP.VALORIZA" type="string" readonly="true">
         <label>
            <message key="riskInstance.field.TEMP.VALORIZA.displayName.txt" />
            <![CDATA[<script type="text/javascript" src="/egrc/scripts/valorization.componenet.js"></script>
                <br/>
                <style>
                            button#btnvalorization  {
                                display: inline-block;
                                padding: 6px 12px;
                                margin-bottom: 0;
                                font-size: 14px;
                                font-weight: 400;
                                line-height: 1.42857143;
                                text-align: center;
                                white-space: nowrap;
                                vertical-align: middle;
                                border-radius: 4px;
                                color: #275e94;
                                background-color: #e6ecf1;
                                border-bottom: 1px solid #5d758e;
                                border-left: 1px solid #7f9db9;
                                border-right: 1px solid #5d758e;  
                                border-top: 1px solid #7f9db9;
                            }                       
                          </style>
                          <br>
                <div class="text-info" id="valorization">
                <div class="well" style=" margin: 0 auto 10px;width:156%">
                          <button id="btnvalorization" type="button" onclick="validaCampos()" class="btn btn-default btn-lg btn-block">Valorizar</button>
                </div>
                </div><td type="text"  style="display: none"]]>
         </label>
      </field>
      <field name="VALORIZACIONMESSAGE" type="readonly">
         <label>
            <message key="riskInstance.field.VALORIZACIONMESSAGE.displayName.txt" />
         </label>
      </field>
      <field name="riskChangeBol" type="readonly" >
         <label>
            <message key="riskInstance.field.riskChangeBol.displayName.txt" />
         </label>
      </field>
      <!--Vigencia de la data  -->
      <field name="riskEffectiveDateDTE" type="date" minSelectableDate="today()" required="true">
         <label>
            <![CDATA[<script language="JavaScript">
                    $("#RISKEFFECTIVEDATEDTE").attr("disabled","true")
                  </script>]]>
            <message key="control.field.riskEffectiveDateDTE.displayName.txt" />
         </label>
         <param name="disabled" value="true" />
      </field>
   </if>
        
</if>
<!-- 
FIN DE CODIGO DE LA VALORIZACION
-->
  



        </tab>
        
         <tab id="attachments">
            <label>
               <message key="application.Attachments.txt" />
            </label>
            <field type="component" component-name="ContentManagement" readonly="(TEMP.impactStatusCd  eq 'APPROVED' or  TEMP.impactStatusCd  eq 'APPROVED2') or  isScreenReadOnly()">
               <param name="groupNumber" value="1" />
            </field>
            <field name="TEMP.VALIDattachments" type="string" >
               <label><![CDATA[ 
                 <script type="text/javascript" language="javascript" src="/egrc/scripts/validAttachedField.js"></script>
                          <script>

                            if ($(document.getElementById("PotentialImpact_TEMP.VALIDATTACHMENTS")).length > 0 ){

                            document.getElementById("PotentialImpact_TEMP.VALIDATTACHMENTS").style.display = 'none';
                                              
                            }
                           
                        </script>
                       ]]>
                  <message key="customObject4.field.VALIDattachments.displayName.txt" />
               </label>
            </field>   
            <validation test="empty(TEMP.VALIDattachments)" >
              <errmsg><message key="errors.VALIDattachments.links.txt"><param value="TEMP.VALIDattachments" /></message></errmsg>
            </validation>              
         </tab>
         <!--Comentarios-->
         <tab id="comments">
            <label>
               <message key="application.Comments.txt" />
            </label>
            <field type="component" component-name="Comments" readonly="(TEMP.impactStatusCd  eq 'APPROVED' or  TEMP.impactStatusCd  eq 'APPROVED2') or  isScreenReadOnly()">
               <label>
                  <message key="application.Comments.txt" />
               </label>
                    <param name="clearOnInit" value="true" />

            </field>
         </tab>
         <!-- bitacora de cambios de detalles -->
         <tab id="historico">
            <label>
               <message key="Historico.details.txt" />
            </label>
            <field name="TEMP.URL_POR_STP" type="component" component-name="IFrameComponent">
               <!-- These params are needed by the component -->
               <param name="height" value="'600px'" />
               <param name="width" value="'1200px'" />
               <param name="url" value="getSASStoredProcessURL()" />
               <param name="_program" value="'/EGRC/STP/egrc_historico_riesgos_especificos_det'" />
               <param name="riskId" value="potentialImpactId" />
            </field>
         </tab>




<if test="TEMP.impactStatusCd eq 'APPROVED2' ">
        <tab id="Quintiles">
          <label>
            <message key="riskInstance.field.Quintiles.displayName.txt"/>
          </label>
          <column-layout>
            <column>
            <field name="TEMP.QUINTILES" type="string"   readonly="true" >
               <label><message key="riskInstance.field.QUINTILES.displayName.txt" /><![CDATA[
              <br/>
              <div class="text-info" id="QUINTILES">
              <p>cargando informaciÃ³n ...</p>
              </div><td type="text"  style="display: none"
               ]]></label>
            </field>

            <field name="RiskQuiPro" type="string" visible="true">
               <label>
                  <message key="quintil probabilidad" />
                  <![CDATA[
                
                  
                  ]]>
                    </label>

            </field>
    

          </column>
          <column>
            <field name="TEMP.QUINTILESCONS" type="string"   readonly="true">
               <label><message key="riskInstance.field.QUINTILESCONS.displayName.txt" /><![CDATA[
               <script type="text/javascript" src="/egrc/scripts/loadquintiles.js"></script>
               <br/>
              <div>
              <p class="text-info" id="QUINTILESCONS" >cargando informaciÃ³n ...</p>
              </div>
              </div><td type="text"  style="display: none" 
               ]]></label>
            </field>

                        <field name="RiskQuiCon" type="string" visible="TRUE ">
               <label>
                  <message key="quintil consecuencia" />
                       <![CDATA[
               <script language="JavaScript">
				document.getElementById("PotentialImpact_RISKQUIPRO").style.display = 'none';
			   </script>
               ]]>
                    </label>

            </field>

          </column>
        </column-layout>



        </tab>
    </if>
    <if test="TEMP.impactStatusCd ne 'APPROVED2' ">
        <tab id="QuintilesProb">
          <label>
            <message key="riskInstance.field.Quintiles.displayName.txt"/>
          </label>
          <column-layout>
            <column>
            <field name="TEMP.QUINTILES" type="string"   readonly="true" >
               <label><message key="riskInstance.field.QUINTILES.displayName.txt" /><![CDATA[
              <br/>
              <div class="text-info" id="QUINTILES">
              <p>cargando informaciÃ³n ...</p>
              </div><td type="text"  style="display: none"
               ]]></label>
            </field>

            <field name="RiskQuiPro" type="string" visible="true">
               <label>
                  <message key="quintil probabilidad" />
                  <![CDATA[
                
                  
                  ]]>
                    </label>

            </field>
    

          </column>
          <column>
            <field name="TEMP.QUINTILESCONS" type="string"   readonly="true">
               <label><message key="riskInstance.field.QUINTILESCONS.displayName.txt" /><![CDATA[
               <script type="text/javascript" src="/egrc/scripts/loadquintiles.js"></script> 
               <br/>
                            <div>
              <p class="text-info" id="QUINTILESCONS" >cargando informaciÃ³n ...</p>
              </div>
              </div><td type="text"  style="display: none" 
               ]]></label>
            </field>

                        <field name="RiskQuiCon" type="string" visible="TRUE ">
               <label>
                  <message key="quintil consecuencia" />
                       <![CDATA[
               <script language="JavaScript">
               document.getElementById("PotentialImpact_RISKQUIPRO").style.display = 'none';
</script>
               ]]>
                    </label>

            </field>

          </column>
        </column-layout>


            <!--valido si existen obligaciones asociados antes de enviar-->
            <field name="TEMP.QUINTILESPROB_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.QUINTILESPROB_VALID").style.display = 'none';
					
						/*if(document.querySelector("#X_MODPROB_OP_1").checked && document.getElementById('TEMP.IMPACTSTATUSVALUE_fldVal').innerText == "CREATE"){
							document.getElementById('RISKQUIPRO').value='N';
						}*/
                      </script>]]>
               <message key="valido quintil de probabilidad" />
                  </label>
            </field>
                        <!--valido si existen obligaciones asociados antes de enviar-->
            <field name="TEMP.QUINTILESCONS_VALID" type="number">
               <label><![CDATA[<script language="JavaScript">
                         document.getElementById("PotentialImpact_TEMP.QUINTILESCONS_VALID").style.display = 'none';
						 
						/*if(document.querySelector("#X_MODCONS_OP_1").checked && document.getElementById('TEMP.IMPACTSTATUSVALUE_fldVal').innerText == "CREATE"){
							document.getElementById('RISKQUICON').value='N';
						}*/					 
                      </script>]]>
               <message key="valido quintil de consecuencia" />
                  </label>
            </field>

                  <validation test="if (TEMP.QUINTILESPROB_VALID gt 0,false,true)">
                           <errmsg ><message key="riskInstance.field.displayName.QUINTILESPROB_valid.Error.txt" /></errmsg>
                  </validation>
                  <validation test="if (TEMP.QUINTILESCONS_VALID gt 0,false,true)">
                           <errmsg ><message key="riskInstance.field.displayName.QUINTILESCONS_valid.Error.txt" /></errmsg>
                  </validation>
            

        </tab>
    </if>

<tab id="repFichRiesgo">
          <label>
            <message key="riskInstance.field.repFichRiesgo.displayName.txt"/>
          </label>

        <field name="TEMP.repFichRiesgo" type="component" component-name="IFrameComponent">
          <param name="height" value="'540px'"/>
          <param name="width" value="'100%'"/>
          <param name="url" value="getSASStoredProcessURL()"/>
          <param name="_program" value="'/EGRC/STP/CargandoReporteFichaRiesgo'" />
          <param name="frameWidth" value="'400'"/>
          <param name="srcapp">saas</param>
        </field>  
</tab>

<tab id="repPat">
          <label>
            <message key="riskInstance.field.repPat.displayName.txt"/>
              <![CDATA[
              <script type="text/javascript" language="javascript" src="/egrc/scripts/reports.component.js"></script>
               ]]>
          </label>  
        <field name="TEMP.repPat" type="component" component-name="IFrameComponent">
          <param name="height" value="'540px'"/>
          <param name="width" value="'100%'"/>
          <param name="url" value="getSASStoredProcessURL()"/>
          <param name="_program" value="'/EGRC/STP/CargandoReportePat'" />
          <param name="frameWidth" value="'400'"/>
          <param name="srcapp">saas</param>
        </field>  
</tab>






         <if test="TEMP.impactStatusCd eq 'APPROVED2' ">
            <field name="TEMP.LOCKTABLE" type="string" visible="true" hideLabel="true" readonly="true">
               <label><![CDATA[<script language="JavaScript">
                    /*tables lock*/

                      tableLockedRisk ("#tblatb",2);
                      tableLockedRisk ("#tbltrtcausa",2);
                      tableLockedRiskMpA ("#atributo3",1);
                      tableLockedRiskMpB ("#atributo4",1); 


                      function lock(){
                        if($("#tblatb input").length >  0){

                          if ($("#tblatb input")[0].disabled == false){
                           tableLockedRisk ("#tblatb",2);
                          }
                        }
                      }
                      setInterval('lock()',1000);
                   


                        blockPat("tablePat");

                     </script>]]></label>
            </field>
          </if>


         <if test="TEMP.impactStatusCd eq 'APPROVED2' or TEMP.Readonly_Approved">
            <field name="TEMP.LOCKTABLE" type="string" visible="true" hideLabel="true" readonly="true">
               <label><![CDATA[<script language="JavaScript">
                    /*tables lock quintiles*/
                    


                   var LOCKTABLE =  window.setInterval(function(){

                            if(document.querySelector("#trmprob") != null){
                              if($($("#trmprob").find("td")[2]).find("input")[0].disabled == false){
                                  lockQuintiles("#trmprob",2);
                              }     
                            }

                        if(document.querySelector("#trmcons") != null){
                              if($($("#trmcons").find("td")[2]).find("input")[0].disabled == false){
                                lockQuintiles("#trmcons",2);
                              }
                        }

                          if(document.querySelector("#tblatb") != undefined){
                            tableLockedRisk ("#tblatb",2);
                             window.clearTimeout(LOCKTABLE);

                          } 


                          if(document.querySelector("#atributo3") != undefined){
                             tableLockedRiskMpA ("#atributo3",1);
                             window.clearTimeout(LOCKTABLE);

                          } 

                          if(document.querySelector("#atributo4") != undefined){
                             tableLockedRiskMpB ("#atributo4",1);                            
                          } 

                           if(document.querySelector("#tbltrtcausa") != undefined){
                              tableLockedRisk ("#tbltrtcausa",2);                        
                          } 





                          /*cuando estent todas las tablas canselo el setinterval*/
                          if (document.querySelector("#trmprob") != null && document.querySelector("#trmcons") != null && document.querySelector("#tblatb") != undefined && document.querySelector("#atributo3") != undefined && document.querySelector("#atributo3") != undefined && document.querySelector("#atributo4") != undefined && document.querySelector("#tbltrtcausa") != undefined ){
                            if($("#trmprob td").eq(5) > 1){
                              if($("#trmprob td").eq(5).html().split('disabled').length > 1 && $("#trmcons td").eq(5).html().split('disabled').length > 1 ){

                              window.clearTimeout(LOCKTABLE);    

                              }
                            }
                          }







                    },1000);

                     </script>]]></label>
            </field>
          </if>


         <if test="TEMP.impactStatusCd eq 'CREATED' or TEMP.impactStatusCd eq 'CREATE' or TEMP.impactStatusCd eq 'APPROVED' or TEMP.impactStatusCd eq 'APPROVED2' or TEMP.impactStatusCd eq 'SUBMITTED' ">
            <field name="TEMP.VALIDEND" type="string" visible="true" hideLabel="true" readonly="true">
               <label><![CDATA[<script language="JavaScript">
                    document.getElementById("PotentialImpact_RISKQUICON").style.display = 'none';
                     </script>]]></label>
            </field>
          </if>

         <if test="empty(Cod_rut)">
          <if test="riskCreadorStr ne riskCreadorStrValid">
            <field name="TEMP.WW" type="string" visible="true" hideLabel="true" readonly="true">
               <label><![CDATA[<script language="JavaScript">


                    document.getElementById("PotentialImpact_RISKQUICON").style.display = 'none';
                    $("#PotentialImpact_RISKSELECTATR").css("display","none")
                    $("#PotentialImpact_RISKPONDATR").css("display","none")




                     var es_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
                     var es_ie = navigator.userAgent.indexOf("MSIE") > -1 ;
                     var es_firefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
                     var obj = document.getElementById("BUSCARUT");
                     var objvaluedet = obj.innerHTML.trim();

                      var RISKFUENTEEXTERNA = document.getElementById("PotentialImpact_RISKFUENTEEXTERNA")
                      var RISKFUENTEINTERNA = document.getElementById("PotentialImpact_RISKFUENTEINTERNA")



                         if ( RISKFUENTEEXTERNA != undefined){
                          RISKFUENTEEXTERNA.style.display = 'none';
                          }

                        if ( RISKFUENTEINTERNA!= undefined){
                          RISKFUENTEINTERNA.style.display = 'none';
                          }
                      
                      $(".cambio").on('keypress', function(e){
                        var keynum = window.event ? window.event.keyCode : e.which; // tecla ingresada
                        if (keynum == 46){
                          return false;
                        }
                       })

                    $(".cambio").on('input', function(){
                        value = $(this).val();
                            if (value.length > 0){
                            }else{
                              $(this).val('0')  

                            } 
                        })

          
                     function darclickdet(){       
                        obj.click();
                        }

                     function buscarutChromeFirefox (){
                     try{
                      if (objvaluedet == "Buscar"){
                        darclickdet(); 
                     }
                        }
                        catch(e) {
                        alert("Error al buscar el rut");
                        }
                     }

                     
                     if(es_chrome){
                     buscarutChromeFirefox();
                     }else if (es_firefox) {
                     buscarutChromeFirefox();
                     }

                     </script>]]></label>
            </field>
          </if>
         </if>
         <tab id="workflow" visible="isSuperUser()">
            <label>
               <message key="workflow.displayName.txt" />
            </label>
            <field type="component" component-name="WorkflowDiagramComponent">
               <param name="leftTreeEnabled" value="isSuperUser()" />
            </field>
         </tab> 
      </tab-section>
      <!--
          <tab id="workflow" visible="isSuperUser()">
            <label>
               <message key="workflow.displayName.txt" />
            </label>
            <field type="component" component-name="WorkflowDiagramComponent">
               <param name="leftTreeEnabled" value="isSuperUser()" />
            </field>
         </tab>
         -->
      <finalize>     
         <!--limpio temporales antes de vlidar y que esten en la version 0-->        
<set name="TEMP.riskNom_VALID" value="if(riskVersNum eq 0 , '',TEMP.riskNom_VALID)" />

     <if test="TEMP.RIKSSEG_link eq RIKSSEG_link and TEMP.RiksOT_link eq RiksOT_link   and TEMP.x_ModProb_op eq x_ModProb_op and TEMP.RiskPondAtr eq RiskPondAtr and TEMP.x_ModCons_op eq x_ModCons_op and TEMP.RiskSelectAtr eq RiskSelectAtr and TEMP.PIselectprocDescCons eq PIselectprocDescCons and TEMP.PIselectprocDesc  eq PIselectprocDesc ">
        <set name="riskChangeBol" value="false" />
     </if>

     <if test="TEMP.RIKSSEG_link ne RIKSSEG_link or TEMP.RiksOT_link ne  RiksOT_link  or TEMP.x_ModProb_op ne x_ModProb_op or TEMP.RiskPondAtr ne RiskPondAtr or TEMP.x_ModCons_op ne x_ModCons_op or TEMP.RiskSelectAtr ne RiskSelectAtr or TEMP.PIselectprocDescCons ne PIselectprocDescCons or TEMP.PIselectprocDesc  ne PIselectprocDesc ">
        <set name="riskChangeBol" value="true" />
     </if>


    <!--<set name="RiskQuiPro" value="if(riskVersNum eq 0 , 'N', RiskQuiPro)" />
    <set name="RiskQuiCon" value="if(riskVersNum eq 0 , 'N', RiskQuiCon)" />-->

   

      <if test="size(getLinkInstancesOfType('MON', 'x_potential_x_customObject4')) >= 2">
      <set name="RiskVar1Str" value="'E'" />
      </if>
      <if test="size(getLinkInstancesOfType('MON', 'x_potential_x_customObject4')) = 1">
      <set name="RiskVar1Str" value="'B'" />
      </if>    

    <if test="size(getLinkInstancesOfType('MON', 'x_potential_x_customObject3')) >= 2">
    <set name="RiskVar2Str" value="'E'" />
    </if>
    <if test="size(getLinkInstancesOfType('MON', 'x_potential_x_customObject3')) = 1">
    <set name="RiskVar2Str" value="'B'" />
    </if>       
      



<if test="toString(ValidaEstadoOt) ne toString('0')">
    <set name="TEMP.ValidaEstadoOt_" value="'B'" />
</if>
<if test="toString(ValidaEstadoOt) eq toString('0')">
  <set name="TEMP.ValidaEstadoOt_" value="'E'" />
</if>

<if test="toString(ValidaEstadoSeg) ne toString('0')">
    <set name="TEMP.ValidaEstadoSeg_" value="'B'" />
</if>
<if test="toString(ValidaEstadoSeg) eq toString('0')">
  <set name="TEMP.ValidaEstadoSeg_" value="'E'" />
</if>

<if test="toString(ValidaEstadoCau) ne toString('0')">
    <set name="TEMP.ValidaEstadoCau_" value="'B'" />
</if>
<if test="toString(ValidaEstadoCau) eq toString('0')">
  <set name="TEMP.ValidaEstadoCau_" value="'E'" />
</if>

<if test="toString(ValidaEstadoCon) ne toString('0')">
    <set name="TEMP.ValidaEstadoCon_" value="'B'" />
</if>
<if test="toString(ValidaEstadoCon) eq toString('0')">
  <set name="TEMP.ValidaEstadoCon_" value="'E'" />
</if>

<if test="toString(ValidaEstadoCar) ne toString('0')">
    <set name="TEMP.ValidaEstadoCar_" value="'B'" />
</if>
<if test="toString(ValidaEstadoCar) eq toString('0')">
  <set name="TEMP.ValidaEstadoCar_" value="'E'" />
</if>

<if test="toString(ValidaEstadoPtr) ne toString('0')">
    <set name="TEMP.ValidaEstadoPtr_" value="'B'" />
</if>
<if test="toString(ValidaEstadoPtr) eq toString('0')">
  <set name="TEMP.ValidaEstadoPtr_" value="'E'" />
</if>

<if test="toString(ValidaEstadoAt) ne toString('0')">
    <set name="TEMP.ValidaEstadoAt_" value="'B'" />
</if>
<if test="toString(ValidaEstadoAt) eq toString('0')">
  <set name="TEMP.ValidaEstadoAt_" value="'E'" />
</if>

<if test="toString(ValidaEstadoTrt) ne toString('0')">
    <set name="TEMP.ValidaEstadoTrt_" value="'B'" />
</if>
<if test="toString(ValidaEstadoTrt) eq toString('0')">
  <set name="TEMP.ValidaEstadoTrt_" value="'E'" />
</if>


    <set name="TEMP.riskNom" value="if(riskVersNum eq 0 , '',TEMP.riskNom)" />
    
         <if test="TEMP.impactStatusCd = 'CREATED' and  riskCreadorStr ne riskCreadorStrValid">
            <if test=" TEMP.riskNom ne riskNom or  TEMP.validFrom ne validFrom or TEMP.validTo ne validTo or TEMP.riskDescrip ne riskDescrip  or TEMP.x_CdC_op ne x_CdC_op or TEMP.riskPartStr ne riskPartStr  ">
                  <set name="riskCreadorStrValid" value="riskCreadorStr" />
            </if>
         </if>

         <if test="empty(riskDescrip)">
            <set name="TEMP.riskDescrip" value="''" />
            <set name="riskDescrip" value="''" />
         </if>

         <if test="empty(riskPartStr)">
            <set name="TEMP.riskPartStr" value="''" />
            <set name="riskPartStr" value="''" />
         </if>

         <if test="empty(x_CdC_op)">
            <set name="TEMP.x_CdC_op" value="''" />
            <set name="x_CdC_op" value="''" />
         </if>

          <if test="empty(validFrom) ">
            <set name="TEMP.validFrom" value="validFrom" />
         </if>

          <if test="empty(validTo)">
            <set name="TEMP.validTo" value="validTo" />
         </if> 
		 
		<if test="TEMP.buttonvalidTo2 eq 'Desactivado'">
			<set name="validTo" value="TEMP.today"/>
			<set name="x_activado" value="x_activado"/>						
		</if>		 

       
       <if test="RiskVar1Str ne 'E' and RiskVar2Str ne 'E' and not empty(getNodeByDimension(location, 'ManagementOrg', null)) and length(riskDescrip) le 3800  and length(riskPartStr) le 3800 ">
		   <if test="validTo &gt;= validFrom or validTo eq validFrom ">
				<if test=" TEMP.riskNom_VALID ne riskNom or  TEMP.validFrom ne validFrom or TEMP.validTo ne validTo or TEMP.riskDescrip ne riskDescrip  or TEMP.x_CdC_op ne x_CdC_op  or TEMP.riskPartStr ne riskPartStr ">
				   <set name="riskCreadorStr" value="currentUser.userid" />
				   <set name="Cod_rut" value="Cod_rut" />
				   <set name="riskVersNum" value="riskVersNum+1" />
           <set name="riskNm" value="riskNom" />
				   <set name="impactNm" value="riskNom" />
				   <set name="TEMP.riskDescrip" value="riskDescrip" />
				   <set name="potImpactNom" value="riskNom" />
				   <set name="TEMP.validFrom" value="validFrom"/>
				   <set name="TEMP.validFrom" value="validTo" />
				   <set name="RiskDtUpdate" value="now()" />
           <set name="updater" value="RISK_UPDATER" />
				   <set name="RISKID" value="potentialImpactId" />
				</if>
		   </if>
       </if>

		 <!-- actualizacion de variable temporal a definitiva -->
			<set name="ImpactVersionNum" value="TEMP.ImpactVersionNum" />
			<set name="ImpactCodigoOrigenStr" value="TEMP.ImpactCodigoOrigenStr" />
			<set name="ImpactCodigoPadreStr" value="TEMP.ImpactCodigoPadreStr" />
			<set name="RiskQuiPro" value="RiskQuiPro" />
     
			<if test="TEMP.impactStatusCd eq 'CREATE' and  riskVersNum eq 1 " >
				<set name ="TEMP.impactStatusCd" value="'CREATED'" />
			</if>


    
			<set name="ImpactVersionStr" value="substring(toString(ImpactVersionNum),0,length(toString(ImpactVersionNum))-3)" />
			<set name="x_clicks" value="x_clicks + 1" />		  
          <if test=" empty(CREATENEWFROM) ">
            <set name="CREATENEWFROM" value="'no'" />
         </if>
          
      </finalize>
   </screen>
</ui-definition>
